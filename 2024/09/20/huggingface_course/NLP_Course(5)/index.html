<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“ | HUI</title><meta name="author" content="HUI"><meta name="copyright" content="HUI"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="è½¬è½½è‡ªï¼šhttps:&#x2F;&#x2F;huggingface.co&#x2F;learn&#x2F;nlp-course&#x2F;zh-CN&#x2F; åŸä¸­æ–‡æ–‡æ¡£æœ‰å¾ˆå¤šåœ°æ–¹ç¿»è¯‘çš„å¤ªæ•·è¡äº†ï¼Œå› æ­¤æ‰æœ‰æ­¤ç³»åˆ—æ–‡ç« ã€‚  NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“ åœ¨å¾®è°ƒæ¨¡å‹æ—¶æœ‰ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š  ä»hugs Face HubåŠ è½½ä¸€ä¸ªæ•°æ®é›†ã€‚ ä½¿ç”¨Dataset.map()å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚ åŠ è½½å’Œè®¡ç®—æŒ‡æ ‡(ç‰¹å¾)ã€‚   æ•°æ®é›†ä¸åœ¨ Hub    Data fo">
<meta property="og:type" content="article">
<meta property="og:title" content="NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“">
<meta property="og:url" content="http://example.com/2024/09/20/huggingface_course/NLP_Course(5)/index.html">
<meta property="og:site_name" content="HUI">
<meta property="og:description" content="è½¬è½½è‡ªï¼šhttps:&#x2F;&#x2F;huggingface.co&#x2F;learn&#x2F;nlp-course&#x2F;zh-CN&#x2F; åŸä¸­æ–‡æ–‡æ¡£æœ‰å¾ˆå¤šåœ°æ–¹ç¿»è¯‘çš„å¤ªæ•·è¡äº†ï¼Œå› æ­¤æ‰æœ‰æ­¤ç³»åˆ—æ–‡ç« ã€‚  NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“ åœ¨å¾®è°ƒæ¨¡å‹æ—¶æœ‰ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š  ä»hugs Face HubåŠ è½½ä¸€ä¸ªæ•°æ®é›†ã€‚ ä½¿ç”¨Dataset.map()å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚ åŠ è½½å’Œè®¡ç®—æŒ‡æ ‡(ç‰¹å¾)ã€‚   æ•°æ®é›†ä¸åœ¨ Hub    Data fo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/2021060111433875004.jpg">
<meta property="article:published_time" content="2024-09-20T14:33:33.000Z">
<meta property="article:modified_time" content="2024-10-08T14:25:34.918Z">
<meta property="article:author" content="HUI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/2021060111433875004.jpg"><link rel="shortcut icon" href="/img/122061154_p0_master1200.jpg"><link rel="canonical" href="http://example.com/2024/09/20/huggingface_course/NLP_Course(5)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-08 22:25:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/bronya.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/87788970_p0_master1200.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">14</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é </span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ™‚é–“è»¸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ¨™ç±¤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†é¡</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å–®</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³æ¨‚</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> é›»å½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹éˆ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> é—œæ–¼</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/2021060111433875004.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="HUI"><img class="site-icon" src="/img/319E33068A7ED73BAE7EB48FCE321DD4.jpg"/><span class="site-name">HUI</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é </span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ™‚é–“è»¸</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ¨™ç±¤</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†é¡</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> æ¸…å–®</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³æ¨‚</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> é›»å½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹éˆ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> é—œæ–¼</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-09-20T14:33:33.000Z" title="å‘è¡¨äº 2024-09-20 22:33:33">2024-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-10-08T14:25:34.918Z" title="æ›´æ–°äº 2024-10-08 22:25:34">2024-10-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/HuggingFace/">HuggingFace</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/HuggingFace/NLP/">NLP</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">16.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>71åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/2024/09/20/huggingface_course/NLP_Course(5)/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2024/09/20/huggingface_course/NLP_Course(5)/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>è½¬è½½è‡ªï¼š<a target="_blank" rel="noopener" href="https://huggingface.co/learn/nlp-course/zh-CN/">https://huggingface.co/learn/nlp-course/zh-CN/</a></p>
<p><strong>åŸä¸­æ–‡æ–‡æ¡£æœ‰å¾ˆå¤šåœ°æ–¹ç¿»è¯‘çš„å¤ªæ•·è¡äº†ï¼Œå› æ­¤æ‰æœ‰æ­¤ç³»åˆ—æ–‡ç« ã€‚</strong></p>
<h1 id="nlpè¯¾ç¨‹äº”-datasetsåº“"><a class="markdownIt-Anchor" href="#nlpè¯¾ç¨‹äº”-datasetsåº“"></a> NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“</h1>
<p>åœ¨å¾®è°ƒæ¨¡å‹æ—¶æœ‰ä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š</p>
<ol>
<li>ä»hugs Face HubåŠ è½½ä¸€ä¸ªæ•°æ®é›†ã€‚</li>
<li>ä½¿ç”¨Dataset.map()å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚</li>
<li>åŠ è½½å’Œè®¡ç®—æŒ‡æ ‡(ç‰¹å¾)ã€‚</li>
</ol>
<h2 id="æ•°æ®é›†ä¸åœ¨-hub"><a class="markdownIt-Anchor" href="#æ•°æ®é›†ä¸åœ¨-hub"></a> æ•°æ®é›†ä¸åœ¨ Hub</h2>
<table>
<thead>
<tr>
<th>Data format</th>
<th>Loading script</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>CSV &amp; TSV</td>
<td><code>csv</code></td>
<td><code>load_dataset(&quot;csv&quot;, data_files=&quot;my_file.csv&quot;)</code></td>
</tr>
<tr>
<td>Text files</td>
<td><code>text</code></td>
<td><code>load_dataset(&quot;text&quot;, data_files=&quot;my_file.txt&quot;)</code></td>
</tr>
<tr>
<td>JSON &amp; JSON Lines</td>
<td><code>json</code></td>
<td><code>load_dataset(&quot;json&quot;, data_files=&quot;my_file.jsonl&quot;)</code></td>
</tr>
<tr>
<td>Pickled DataFrames</td>
<td><code>pandas</code></td>
<td><code>load_dataset(&quot;pandas&quot;, data_files=&quot;my_dataframe.pkl&quot;)</code></td>
</tr>
</tbody>
</table>
<p>å¯¹äºæ¯ç§æ•°æ®æ ¼å¼, æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <code>load_dataset()</code> å‡½æ•°, ä½¿ç”¨ <code>data_files</code> æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶çš„è·¯å¾„çš„å‚æ•°</p>
<h3 id="1åŠ è½½æœ¬åœ°æ•°æ®é›†"><a class="markdownIt-Anchor" href="#1åŠ è½½æœ¬åœ°æ•°æ®é›†"></a> 1.åŠ è½½æœ¬åœ°æ•°æ®é›†</h3>
<p>ä»¥<a target="_blank" rel="noopener" href="https://github.com/crux82/squad-it/">SQuAD_it dataset</a>ä¸ºä¾‹ï¼Œä¸‹è½½å¹¶ä¸”è§£å‹åå¯ä»¥å¾—åˆ°SQuAD_it-train.jsonå’ŒSQuAD_it-test.json</p>
<p>ä½¿ç”¨<code>load_dataset()</code>å‡½æ•°æ¥åŠ è½½JSONæ–‡ä»¶, <font color="red">æˆ‘ä»¬åªéœ€è¦çŸ¥é“æˆ‘ä»¬æ˜¯åœ¨å¤„ç†æ™®é€šçš„ JSON(ç±»ä¼¼äºåµŒå¥—å­—å…¸)è¿˜æ˜¯ JSON è¡Œ(è¡Œåˆ†éš”çš„ JSON)ã€‚åƒè®¸å¤šé—®ç­”æ•°æ®é›†ä¸€æ ·, SQuAD-it ä½¿ç”¨åµŒå¥—æ ¼å¼,æ‰€æœ‰æ–‡æœ¬éƒ½å­˜å‚¨åœ¨ <code>data</code>æ–‡ä»¶ä¸­ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šå‚æ•°<code>field</code>æ¥åŠ è½½æ•°æ®é›†,å¦‚ä¸‹æ‰€ç¤º:</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">squad_it_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=<span class="string">&quot;SQuAD_it-train.json&quot;</span>, field=<span class="string">&quot;data&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹, åŠ è½½æœ¬åœ°æ–‡ä»¶ä¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰<code>train</code>çš„<code>DatasetDict</code> å¯¹è±¡ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>squad_it_dataset</code>æŸ¥çœ‹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">squad_it_dataset</span><br><span class="line"></span><br><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;paragraphs&#x27;</span>], <span class="comment"># åˆ—å</span></span><br><span class="line">        num_rows: <span class="number">442</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™å‘æˆ‘ä»¬æ˜¾ç¤ºäº†ä¸è®­ç»ƒé›†ç›¸å…³è”çš„è¡Œæ•°å’Œåˆ—åã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•åˆ° <code>train</code> æŸ¥çœ‹ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">squad_it_dataset[<span class="string">&quot;train&quot;</span>][<span class="number">0</span>] <span class="comment"># è®­ç»ƒé›†çš„2ç¬¬ä¸€è¡Œ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Terremoto del Sichuan del 2008&quot;</span>,</span><br><span class="line">    <span class="string">&quot;paragraphs&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;context&quot;</span>: <span class="string">&quot;Il terremoto del Sichuan del 2008 o il terremoto...&quot;</span>,</span><br><span class="line">            <span class="string">&quot;qas&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;answers&quot;</span>: [&#123;<span class="string">&quot;answer_start&quot;</span>: <span class="number">29</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2008&quot;</span>&#125;],</span><br><span class="line">                    <span class="string">&quot;id&quot;</span>: <span class="string">&quot;56cdca7862d2951400fa6826&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;question&quot;</span>: <span class="string">&quot;In quale anno si Ã¨ verificato il terremoto nel Sichuan?&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                ...</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font size="5">åŒæ—¶åŠ è½½è®­ç»ƒé›†ä¸æµ‹è¯•é›†</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">data_files = &#123;<span class="string">&quot;train&quot;</span>: <span class="string">&quot;SQuAD_it-train.json&quot;</span>, <span class="string">&quot;test&quot;</span>: <span class="string">&quot;SQuAD_it-test.json&quot;</span>&#125;</span><br><span class="line">squad_it_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files, field=<span class="string">&quot;data&quot;</span>)</span><br><span class="line">squad_it_dataset</span><br><span class="line"></span><br><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;paragraphs&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">442</span></span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;paragraphs&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">48</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><font color="red"><code>load_dataset()</code>å‡½æ•°çš„<code>data_files</code>å‚æ•°éå¸¸çµæ´»å¹¶ä¸”å¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶è·¯å¾„åˆ—è¡¨æˆ–å°†åˆ†å‰²åçš„åç§°æ˜ å°„åˆ°æ–‡ä»¶è·¯å¾„çš„å­—å…¸ã€‚æ‚¨è¿˜å¯ä»¥æ ¹æ®Unix shellä½¿ç”¨çš„è§„åˆ™å¯¹ä¸æŒ‡å®šæ¨¡å¼åŒ¹é…çš„æ–‡ä»¶è¿›è¡Œå…¨å±€å®šä½ï¼ˆä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®â€™data_files=â€œ*.JSONâ€â€˜å°†ç›®å½•ä¸­çš„æ‰€æœ‰JSONæ–‡ä»¶ä½œä¸ºå•ä¸ªæ‹†åˆ†è¿›è¡Œå…¨å±€å®šä½ï¼‰ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ğŸ¤—Datasets æ–‡æ¡£ã€‚</font></p>
<p>ğŸ¤— Datasetså®é™…ä¸Šæ”¯æŒè¾“å…¥æ–‡ä»¶çš„è‡ªåŠ¨è§£å‹,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è·³è¿‡ä½¿ç”¨<code>gzip</code>,ç›´æ¥è®¾ç½® <code>data_files</code>å‚æ•°ä¼ é€’å‹ç¼©æ–‡ä»¶:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_files = &#123;<span class="string">&quot;train&quot;</span>: <span class="string">&quot;SQuAD_it-train.json.gz&quot;</span>, <span class="string">&quot;test&quot;</span>: <span class="string">&quot;SQuAD_it-test.json.gz&quot;</span>&#125;</span><br><span class="line">squad_it_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files, field=<span class="string">&quot;data&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2åŠ è½½è¿œç¨‹æ•°æ®é›†"><a class="markdownIt-Anchor" href="#2åŠ è½½è¿œç¨‹æ•°æ®é›†"></a> 2.åŠ è½½è¿œç¨‹æ•°æ®é›†</h3>
<p>å¦‚æœä½ åœ¨å…¬å¸æ‹…ä»»æ•°æ®ç ”ç©¶å‘˜æˆ–ç¼–ç å‘˜,é‚£ä¹ˆä½ è¦åˆ†æçš„æ•°æ®é›†å¾ˆæœ‰å¯èƒ½å­˜å‚¨åœ¨æŸä¸ªè¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚å¹¸è¿çš„æ˜¯,åŠ è½½è¿œç¨‹æ–‡ä»¶å°±åƒåŠ è½½æœ¬åœ°æ–‡ä»¶ä¸€æ ·ç®€å•!æˆ‘ä»¬æ²¡æœ‰æä¾›æœ¬åœ°æ–‡ä»¶çš„è·¯å¾„, è€Œæ˜¯å°†<code>load_dataset()</code>çš„<code>data_files</code>å‚æ•°æŒ‡å‘å­˜å‚¨è¿œç¨‹æ–‡ä»¶çš„ä¸€ä¸ªæˆ–å¤šä¸ªURLã€‚ä¾‹å¦‚, å¯¹äºæ‰˜ç®¡åœ¨ GitHub ä¸Šçš„ SQuAD-it æ•°æ®é›†, æˆ‘ä»¬å¯ä»¥å°† <code>data_files</code> æŒ‡å‘ <em>SQuAD_it-*.json.gz</em> çš„ç½‘å€,å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&quot;https://github.com/crux82/squad-it/raw/master/&quot;</span></span><br><span class="line">data_files = &#123;</span><br><span class="line">    <span class="string">&quot;train&quot;</span>: url + <span class="string">&quot;SQuAD_it-train.json.gz&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: url + <span class="string">&quot;SQuAD_it-test.json.gz&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">squad_it_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files, field=<span class="string">&quot;data&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="åˆ‡ç‰‡æ•°æ®æ¸…æ´—"><a class="markdownIt-Anchor" href="#åˆ‡ç‰‡æ•°æ®æ¸…æ´—"></a> åˆ‡ç‰‡ï¼ˆæ•°æ®æ¸…æ´—ï¼‰</h2>
<h3 id="1åˆ‡ç‰‡ä¸åˆ‡åˆ†æ•°æ®"><a class="markdownIt-Anchor" href="#1åˆ‡ç‰‡ä¸åˆ‡åˆ†æ•°æ®"></a> 1.åˆ‡ç‰‡ä¸åˆ‡åˆ†æ•°æ®</h3>
<p>ä»¥<a target="_blank" rel="noopener" href="https://archive.ics.uci.edu/ml/index.php">åŠ å·å¤§å­¦æ¬§æ–‡åˆ†æ ¡æœºå™¨å­¦ä¹ å­˜å‚¨åº“</a>çš„<a target="_blank" rel="noopener" href="https://archive.ics.uci.edu/ml/datasets/Drug+Review+Dataset+(Drugs.com)">è¯ç‰©å®¡æŸ¥æ•°æ®é›†</a>ä¸ºä¾‹ï¼Œå…¶ä¸­åŒ…å«æ‚£è€…å¯¹å„ç§è¯ç‰©çš„è¯„è®ºï¼Œä»¥åŠæ­£åœ¨æ²»ç–—çš„ç—…æƒ…å’Œæ‚£è€…æ»¡æ„åº¦çš„ 10 æ˜Ÿè¯„çº§ã€‚</p>
<p>ç”±äº TSV åªæ˜¯ä½¿ç”¨åˆ¶è¡¨ç¬¦è€Œä¸æ˜¯é€—å·ä½œä¸ºåˆ†éš”ç¬¦çš„ CSV å˜ä½“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŠ è½½<strong>csv</strong>æ–‡ä»¶çš„**load_dataset()**å‡½æ•°å¹¶æŒ‡å®šåˆ†éš”ç¬¦ ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">data_files = &#123;<span class="string">&quot;train&quot;</span>: <span class="string">&quot;drugsComTrain_raw.tsv&quot;</span>, <span class="string">&quot;test&quot;</span>: <span class="string">&quot;drugsComTest_raw.tsv&quot;</span>&#125;</span><br><span class="line"><span class="comment"># \t is the tab character in Python</span></span><br><span class="line">drug_dataset = load_dataset(<span class="string">&quot;csv&quot;</span>, data_files=data_files, delimiter=<span class="string">&quot;\t&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><font color="red">åœ¨è¿›è¡Œä»»ä½•ç±»å‹çš„æ•°æ®åˆ†ææ—¶ï¼Œä¸€ä¸ªå¥½çš„åšæ³•æ˜¯æŠ½å–ä¸€ä¸ªå°çš„éšæœºæ ·æœ¬ï¼Œä»¥å¿«é€Ÿäº†è§£æ‚¨æ­£åœ¨å¤„ç†çš„æ•°æ®ç±»å‹ã€‚</font>åœ¨ğŸ¤—æ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é“¾æ¥ <strong>Dataset.shuffle()</strong> å’Œ <strong>Dataset.select()</strong> å…±åŒæ¥å®ŒæˆæŠ½å–ï¼š</p>
<p>ï¼ˆ<strong>Dataset.shuffle()</strong> å’Œ **Dataset.select()**è§<a target="_blank" rel="noopener" href="https://huggingface.co/docs/datasets/v2.21.0/process%EF%BC%89">https://huggingface.co/docs/datasets/v2.21.0/processï¼‰</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drug_sample = drug_dataset[<span class="string">&quot;train&quot;</span>].shuffle(seed=<span class="number">42</span>).select(<span class="built_in">range</span>(<span class="number">1000</span>))</span><br><span class="line"><span class="comment"># Peek at the first few examples</span></span><br><span class="line">drug_sample[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;Unnamed: 0&#x27;</span>: [<span class="number">87571</span>, <span class="number">178045</span>, <span class="number">80482</span>],</span><br><span class="line"> <span class="string">&#x27;drugName&#x27;</span>: [<span class="string">&#x27;Naproxen&#x27;</span>, <span class="string">&#x27;Duloxetine&#x27;</span>, <span class="string">&#x27;Mobic&#x27;</span>],</span><br><span class="line"> <span class="string">&#x27;condition&#x27;</span>: [<span class="string">&#x27;Gout, Acute&#x27;</span>, <span class="string">&#x27;ibromyalgia&#x27;</span>, <span class="string">&#x27;Inflammatory Conditions&#x27;</span>],</span><br><span class="line"> <span class="string">&#x27;review&#x27;</span>: [<span class="string">&#x27;&quot;like the previous person mention, I&amp;#039;m a strong believer of aleve, it works faster for my gout than the prescription meds I take. No more going to the doctor for refills.....Aleve works!&quot;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&quot;I have taken Cymbalta for about a year and a half for fibromyalgia pain. It is great\r\nas a pain reducer and an anti-depressant, however, the side effects outweighed \r\nany benefit I got from it. I had trouble with restlessness, being tired constantly,\r\ndizziness, dry mouth, numbness and tingling in my feet, and horrible sweating. I am\r\nbeing weaned off of it now. Went from 60 mg to 30mg and now to 15 mg. I will be\r\noff completely in about a week. The fibro pain is coming back, but I would rather deal with it than the side effects.&quot;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;&quot;I have been taking Mobic for over a year with no side effects other than an elevated blood pressure.  I had severe knee and ankle pain which completely went away after taking Mobic.  I attempted to stop the medication however pain returned after a few days.&quot;&#x27;</span>],</span><br><span class="line"> <span class="string">&#x27;rating&#x27;</span>: [<span class="number">9.0</span>, <span class="number">3.0</span>, <span class="number">10.0</span>],</span><br><span class="line"> <span class="string">&#x27;date&#x27;</span>: [<span class="string">&#x27;September 2, 2015&#x27;</span>, <span class="string">&#x27;November 7, 2011&#x27;</span>, <span class="string">&#x27;June 5, 2013&#x27;</span>],</span><br><span class="line"> <span class="string">&#x27;usefulCount&#x27;</span>: [<span class="number">36</span>, <span class="number">13</span>, <span class="number">128</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨**Dataset.shuffle()**é€‰å–äº†å›ºå®šçš„éšæœºæ•°ç§å­ã€‚ <strong>Dataset.select()</strong> éœ€è¦ä¸€ä¸ªå¯è¿­ä»£çš„ç´¢å¼•ï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»é€šè¿‡äº† <strong>range(1000)</strong> ä»éšæœºæ‰“ä¹±çš„æ•°æ®é›†ä¸­é€‰å–å‰ 1,000 ä¸ªç¤ºä¾‹ã€‚ä»æŠ½å–çš„æ•°æ®ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ•°æ®é›†çš„ä¸€äº›ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>Unnamed: 0</strong>è¿™åˆ—çœ‹èµ·æ¥å¾ˆåƒæ¯ä¸ªæ‚£è€…çš„åŒ¿å IDã€‚</li>
<li><strong>condition</strong> è¿™åˆ—åŒ…å«æœ‰æè¿°å¥åº·çŠ¶å†µçš„æ ‡ç­¾ã€‚</li>
<li>è¯„è®ºé•¿çŸ­ä¸ä¸€ï¼Œæ··åˆæœ‰ Python è¡Œåˆ†éš”ç¬¦ (<strong>\r\n</strong>) ä»¥åŠ HTML å­—ç¬¦ä»£ç ï¼Œå¦‚**'**ã€‚</li>
</ul>
<p><font size="5">Dataset.unique() </font></p>
<p>ä¸ºäº†éªŒè¯<strong>Unnamed: 0</strong> åˆ—å­˜å‚¨çš„æ˜¯æ‚£è€… IDçš„çŒœæƒ³ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>Dataset.unique()</strong> å‡½æ•°æ¥éªŒè¯åŒ¿åID çš„æ•°é‡æ˜¯å¦ä¸æ‹†åˆ†åæ¯éƒ¨åˆ†ä¸­çš„è¡Œæ•°åŒ¹é…ï¼š</p>
<p><font color="red">Dataset.unique()ç”¨äºå»é‡</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> split <span class="keyword">in</span> drug_dataset.keys():</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(drug_dataset[split]) == <span class="built_in">len</span>(drug_dataset[split].unique(<span class="string">&quot;Unnamed: 0&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>è¿™ä¼¼ä¹è¯å®äº†æˆ‘ä»¬çš„å‡è®¾ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æŠŠ <strong>Unnamed: 0</strong> åˆ—é‡å‘½åä¸ºæ‚£è€…çš„idã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **DatasetDict.rename_column()**å‡½æ•°ä¸€æ¬¡æ€§é‡å‘½åDatasetDictä¸­å…±æœ‰çš„åˆ—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.rename_column(</span><br><span class="line">    original_column_name=<span class="string">&quot;Unnamed: 0&quot;</span>, new_column_name=<span class="string">&quot;patient_id&quot;</span></span><br><span class="line">)</span><br><span class="line">drug_dataset</span><br><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">161297</span></span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">53766</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <strong>Dataset.map()<strong>æ ‡å‡†åŒ–æ‰€æœ‰ <strong>condition</strong> æ ‡ç­¾ .æ­£å¦‚æˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter3">ç¬¬ä¸‰ç« </a>ä¸­æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå¯ä»¥å°†è¯¥å‡½æ•°åº”ç”¨äº</strong>drug_dataset</strong> æ‹†åˆ†åæ¯éƒ¨åˆ†çš„æ‰€æœ‰è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lowercase_condition</span>(<span class="params">example</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&quot;condition&quot;</span>: example[<span class="string">&quot;condition&quot;</span>].lower()&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">drug_dataset.<span class="built_in">map</span>(lowercase_condition)</span><br><span class="line"></span><br><span class="line">AttributeError: <span class="string">&#x27;NoneType&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;lower&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å“¦ä¸ï¼Œæˆ‘ä»¬çš„mapåŠŸèƒ½é‡åˆ°äº†é—®é¢˜ï¼ä»é”™è¯¯ä¸­æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡º <strong>condition</strong> åˆ—å­˜åœ¨ <strong>None</strong> , ä¸èƒ½è½¬æ¢ä¸ºå°å†™ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯å­—ç¬¦ä¸²ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ <strong>Dataset.filter()</strong> åˆ é™¤è¿™äº›è¡Œ ï¼Œå…¶å·¥ä½œæ–¹å¼ç±»ä¼¼äº <strong>Dataset.map()</strong> ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">filter_nones</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x[<span class="string">&quot;condition&quot;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åè¿è¡Œ <strong>drug_dataset.filter(filter_nones)</strong></p>
<p><font size="5">lambda å‡½æ•°ï¼š</font></p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ä¸€è¡Œä¸­ä½¿ç”¨lambda å‡½æ•°.åœ¨ Python ä¸­ï¼Œlambda å‡½æ•°æ˜¯æ‚¨æ— éœ€æ˜ç¡®å‘½åå³å¯ä½¿ç”¨çš„å¾®å‡½æ•°ï¼ˆåŒ¿åå‡½æ•°ï¼‰ã€‚å®ƒä»¬ä¸€èˆ¬é‡‡ç”¨å¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lambda</span> &lt;arguments&gt; : &lt;expression&gt;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<strong>lambda</strong> æ˜¯ Python çš„ç‰¹æ®Š<a target="_blank" rel="noopener" href="https://docs.python.org/3/reference/lexical_analysis.html#keywords">å…³é”®å­—</a>, <strong>arguments</strong> æ˜¯ä»¥é€—å·è¿›è¡Œåˆ†éš”çš„å‡½æ•°è¾“å…¥çš„åˆ—è¡¨/é›†åˆï¼Œ <strong>expression</strong> ä»£è¡¨æ‚¨å¸Œæœ›æ‰§è¡Œçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç®€å•çš„ lambda å‡½æ•°æ¥å¯¹ä¸€ä¸ªæ•°å­—è¿›è¡Œå¹³æ–¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lambda</span> x : x * x</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬éœ€è¦å°†è¦è¾“å…¥ç»™è¿™ä¸ªå‡½æ•°å€¼æ‹¬åœ¨æ‹¬å·ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">lambda</span> x: x * x)(<span class="number">3</span>)</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨é€—å·åˆ†éš”å¤šä¸ªå‚æ•°æ¥å®šä¹‰ lambda å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼è®¡ç®—ä¸‰è§’å½¢çš„é¢ç§¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">lambda</span> base, height: <span class="number">0.5</span> * base * height)(<span class="number">4</span>, <span class="number">8</span>)</span><br><span class="line"><span class="number">16.0</span></span><br></pre></td></tr></table></figure>
<p>å½“æ‚¨æƒ³å®šä¹‰å°å‹ã€ä¸€æ¬¡æ€§ä½¿ç”¨çš„å‡½æ•°æ—¶ï¼ŒLambda å‡½æ•°éå¸¸æ–¹ä¾¿</p>
</blockquote>
<p><font size="5">ç®€å•çš„æ˜ å°„å’Œè¿‡æ»¤æ“ä½œ</font></p>
<p>åœ¨ğŸ¤— Datasets ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lambda å‡½æ•°æ¥å®šä¹‰ç®€å•çš„æ˜ å°„å’Œè¿‡æ»¤æ“ä½œï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæŠ€å·§æ¥æ¶ˆé™¤æˆ‘ä»¬æ•°æ®é›†ä¸­çš„ <strong>None</strong> æ¡ç›®ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;condition&quot;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p>å½“ <strong>None</strong> æ¡ç›®å·²åˆ é™¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ‡å‡†åŒ–æˆ‘ä»¬çš„ <strong>condition</strong> åˆ—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.<span class="built_in">map</span>(lowercase_condition)</span><br><span class="line"><span class="comment"># Check that lowercasing worked</span></span><br><span class="line">drug_dataset[<span class="string">&quot;train&quot;</span>][<span class="string">&quot;condition&quot;</span>][:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;left ventricular dysfunction&#x27;</span>, <span class="string">&#x27;adhd&#x27;</span>, <span class="string">&#x27;birth control&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="2åˆ›å»ºæ–°çš„æ•°æ®åˆ—"><a class="markdownIt-Anchor" href="#2åˆ›å»ºæ–°çš„æ•°æ®åˆ—"></a> 2.åˆ›å»ºæ–°çš„æ•°æ®åˆ—</h3>
<p>æ¯å½“æ‚¨å¤„ç†å®¢æˆ·è¯„è®ºæ—¶ï¼Œä¸€ä¸ªå¥½çš„åšæ³•æ˜¯æ£€æŸ¥æ¯ä¸ªè¯„è®ºä¸­çš„å­—æ•°ã€‚è¯„è®ºå¯èƒ½åªæ˜¯ä¸€ä¸ªè¯ï¼Œæ¯”å¦‚â€œå¤ªæ£’äº†ï¼â€æˆ–åŒ…å«æ•°åƒå­—çš„å®Œæ•´æ–‡ç« ï¼Œæ ¹æ®å®é™…çš„æƒ…å†µï¼Œæ‚¨éœ€è¦ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†è¿™äº›æç«¯æƒ…å†µã€‚ä¸ºäº†è®¡ç®—æ¯æ¡è¯„è®ºä¸­çš„å•è¯æ•°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åŸºäºç©ºæ ¼åˆ†å‰²æ¯ä¸ªæ–‡æœ¬çš„ç²—ç•¥æ–¹æ³•ã€‚</p>
<blockquote>
<ul>
<li><strong>æŒ‰ç©ºæ ¼åˆ†å‰²â€™reviewâ€™è¿™ä¸€åˆ—çš„å¥å­ï¼Œè®¡ç®—â€™reviewâ€™ä¸­åŒ…å«çš„è¯æ•°å¹¶å°†å…¶ä½œä¸ºæ–°çš„åˆ—ã€‚</strong></li>
<li><strong>åˆ é™¤åŒ…å«å°‘äº 30 ä¸ªå•è¯çš„è¯„è®º</strong></li>
<li><strong>è¯„è®ºä¸­å¯èƒ½å­˜åœ¨ HTML å­—ç¬¦ä»£ç ä½¿ç”¨ Python çš„htmlæ¨¡å—å–æ¶ˆè¿™äº›å­—ç¬¦çš„è½¬ä¹‰</strong></li>
</ul>
</blockquote>
<p><strong>æŒ‰ç©ºæ ¼åˆ†å‰²â€™reviewâ€™è¿™ä¸€åˆ—çš„å¥å­ï¼Œè®¡ç®—â€™reviewâ€™ä¸­åŒ…å«çš„è¯æ•°å¹¶å°†å…¶ä½œä¸ºæ–°çš„åˆ—ã€‚</strong></p>
<blockquote>
<p>è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥è®¡ç®—æ¯æ¡è¯„è®ºä¸­çš„å•è¯æ•°ï¼š</p>
<p><font color="red">Dataset.split()é»˜è®¤æŒ‰ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">compute_review_length</span>(<span class="params">example</span>):</span><br><span class="line"> <span class="keyword">return</span> &#123;<span class="string">&quot;review_length&quot;</span>: <span class="built_in">len</span>(example[<span class="string">&quot;review&quot;</span>].split())&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸æˆ‘ä»¬çš„ <code>lowercase_condition()</code> å‡½æ•°ä¸åŒï¼Œ<code>compute_review_length()</code> è¿”å›ä¸€ä¸ªå­—å…¸ï¼Œå…¶é”®ä¸æ•°æ®é›†ä¸­çš„åˆ—åä¹‹ä¸€ä¸å¯¹åº”ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ <code>compute_review_length()</code> ä¼ é€’ç»™ <code>Dataset.map()</code> æ—¶ï¼Œå®ƒå°†åº”ç”¨äºæ•°æ®é›†ä¸­çš„æ‰€æœ‰è¡Œä»¥åˆ›å»ºæ–°çš„ <code>review_length</code> åˆ—ï¼š</strong></p>
<p><font color="red">(Dataset.map()é»˜è®¤æŒ‰è¡Œè¿›è¡Œæ“ä½œï¼Œä¸”äº§ç”Ÿçš„æ–°çš„åˆ—æ·»åŠ åˆ°è¡¨æ ¼åˆ—çš„æœ«å°¾)</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.<span class="built_in">map</span>(compute_review_length)</span><br><span class="line"><span class="comment"># Inspect the first training example</span></span><br><span class="line">drug_dataset[<span class="string">&quot;train&quot;</span>][<span class="number">0</span>] <span class="comment"># è®­ç»ƒé›†ç¬¬ä¸€è¡Œ</span></span><br><span class="line">&#123;<span class="string">&#x27;patient_id&#x27;</span>: <span class="number">206461</span>,</span><br><span class="line"><span class="string">&#x27;drugName&#x27;</span>: <span class="string">&#x27;Valsartan&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;condition&#x27;</span>: <span class="string">&#x27;left ventricular dysfunction&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;review&#x27;</span>: <span class="string">&#x27;&quot;It has no side effect, I take it in combination of Bystolic 5 Mg and Fish Oil&quot;&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;rating&#x27;</span>: <span class="number">9.0</span>,</span><br><span class="line"><span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;May 20, 2012&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;usefulCount&#x27;</span>: <span class="number">27</span>,</span><br><span class="line"><span class="string">&#x27;review_length&#x27;</span>: <span class="number">17</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä½¿ç”¨ **Dataset.sort()**å¯¹è¿™ä¸ªæ–°åˆ—è¿›è¡Œæ’åºï¼Œç„¶åæŸ¥çœ‹æç«¯é•¿åº¦çš„è¯„è®ºçš„æ ·å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset[<span class="string">&quot;train&quot;</span>].sort(<span class="string">&quot;review_length&quot;</span>)[:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;patient_id&#x27;</span>: [<span class="number">103488</span>, <span class="number">23627</span>, <span class="number">20558</span>],</span><br><span class="line"><span class="string">&#x27;drugName&#x27;</span>: [<span class="string">&#x27;Loestrin 21 1 / 20&#x27;</span>, <span class="string">&#x27;Chlorzoxazone&#x27;</span>, <span class="string">&#x27;Nucynta&#x27;</span>],</span><br><span class="line"><span class="string">&#x27;condition&#x27;</span>: [<span class="string">&#x27;birth control&#x27;</span>, <span class="string">&#x27;muscle spasm&#x27;</span>, <span class="string">&#x27;pain&#x27;</span>],</span><br><span class="line"><span class="string">&#x27;review&#x27;</span>: [<span class="string">&#x27;&quot;Excellent.&quot;&#x27;</span>, <span class="string">&#x27;&quot;useless&quot;&#x27;</span>, <span class="string">&#x27;&quot;ok&quot;&#x27;</span>],</span><br><span class="line"><span class="string">&#x27;rating&#x27;</span>: [<span class="number">10.0</span>, <span class="number">1.0</span>, <span class="number">6.0</span>],</span><br><span class="line"><span class="string">&#x27;date&#x27;</span>: [<span class="string">&#x27;November 4, 2008&#x27;</span>, <span class="string">&#x27;March 24, 2017&#x27;</span>, <span class="string">&#x27;August 20, 2016&#x27;</span>],</span><br><span class="line"><span class="string">&#x27;usefulCount&#x27;</span>: [<span class="number">5</span>, <span class="number">2</span>, <span class="number">10</span>],</span><br><span class="line"><span class="string">&#x27;review_length&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]&#125;</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚æˆ‘ä»¬æ‰€çŒœæƒ³çš„é‚£æ ·ï¼Œä¸€äº›è¯„è®ºåªåŒ…å«ä¸€ä¸ªè¯ï¼Œè™½ç„¶è¿™å¯¹äºæƒ…æ„Ÿåˆ†ææ¥è¯´å¯èƒ½æ²¡é—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦é¢„æµ‹ç—…æƒ…ï¼Œè¿™äº›è¯„è®ºå¯èƒ½å¹¶ä¸é€‚åˆã€‚</p>
</blockquote>
<p><strong>åˆ é™¤åŒ…å«å°‘äº 30 ä¸ªå•è¯çš„è¯„è®º</strong></p>
<blockquote>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ <strong>Dataset.filter()</strong> åŠŸèƒ½æ¥åˆ é™¤åŒ…å«å°‘äº 30 ä¸ªå•è¯çš„è¯„è®ºã€‚ä¸æˆ‘ä»¬å¯¹ <strong>condition</strong> åˆ—çš„å¤„ç†ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€‰å–è¯„è®ºçš„é•¿åº¦é«˜äºæ­¤é˜ˆå€¼æ¥è¿‡æ»¤æ‰éå¸¸çŸ­çš„è¯„è®ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;review_length&quot;</span>] &gt; <span class="number">30</span>)</span><br><span class="line"><span class="built_in">print</span>(drug_dataset.num_rows)</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;train&#x27;</span>: <span class="number">138514</span>, <span class="string">&#x27;test&#x27;</span>: <span class="number">46108</span>&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>è¯„è®ºä¸­å¯èƒ½å­˜åœ¨ HTML å­—ç¬¦ä»£ç ä½¿ç”¨ Python çš„htmlæ¨¡å—å–æ¶ˆè¿™äº›å­—ç¬¦çš„è½¬ä¹‰</strong></p>
<blockquote>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">text = <span class="string">&quot;I&amp;#039;m a transformer called BERT&quot;</span></span><br><span class="line">html.unescape(text)</span><br><span class="line"><span class="string">&quot;I&#x27;m a transformer called BERT&quot;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ <strong>Dataset.map()</strong> å¯¹æˆ‘ä»¬è¯­æ–™åº“ä¸­çš„æ‰€æœ‰ HTML å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset = drug_dataset.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: &#123;<span class="string">&quot;review&quot;</span>: html.unescape(x[<span class="string">&quot;review&quot;</span>])&#125;)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="3åŠ é€Ÿmapæ–¹æ³•"><a class="markdownIt-Anchor" href="#3åŠ é€Ÿmapæ–¹æ³•"></a> 3.åŠ é€Ÿmapæ–¹æ³•</h3>
<p><font size="5">Dataset.map()å‡½æ•°æ—¶æŒ‡å®š batched=Trueã€‚</font></p>
<blockquote>
<p><strong>Dataset.map()</strong> æ–¹æ³•æœ‰ä¸€ä¸ª <strong>batched</strong> å‚æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º <strong>True</strong> , map å‡½æ•°å°†ä¼šåˆ†æ‰¹æ‰§è¡Œæ‰€éœ€è¦è¿›è¡Œçš„æ“ä½œï¼ˆæ‰¹é‡å¤§å°æ˜¯å¯é…ç½®çš„ï¼Œä½†é»˜è®¤ä¸º 1,000ï¼‰ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨åˆ—è¡¨æ¨å¯¼åŒæ—¶å¤„ç†å¤šä¸ªå…ƒç´ æ¥åŠ å¿«é€Ÿåº¦ã€‚</p>
<p>å½“æ‚¨åœ¨ä½¿ç”¨ **Dataset.map()**å‡½æ•°æ—¶æŒ‡å®š <strong>batched=True</strong>ã€‚<font color="red">è¯¥å‡½æ•°ä¼šæ¥æ”¶ä¸€ä¸ªåŒ…å«æ•°æ®é›†å­—æ®µçš„å­—å…¸ï¼Œæ¯ä¸ªå€¼éƒ½æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œä¸ä»…ä»…æ˜¯å•ä¸ªå€¼ã€‚<strong>Dataset.map()</strong> çš„è¿”å›å€¼åº”è¯¥æ˜¯ç›¸åŒçš„ï¼šä¸€ä¸ªåŒ…å«æˆ‘ä»¬æƒ³è¦æ›´æ–°æˆ–æ·»åŠ åˆ°æ•°æ®é›†ä¸­çš„å­—æ®µçš„å­—å…¸ï¼Œå­—å…¸çš„é”®æ˜¯è¦æ·»åŠ çš„å­—æ®µï¼Œå­—å…¸çš„å€¼æ˜¯ç»“æœçš„åˆ—è¡¨ã€‚</font></p>
<p>ä¾‹å¦‚ï¼Œè¿™æ˜¯ä½¿ç”¨ <strong>batched=True</strong>å¯¹æ‰€æœ‰ HTML å­—ç¬¦è¿›è¡Œè½¬ä¹‰çš„æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new_drug_dataset = drug_dataset.<span class="built_in">map</span>(</span><br><span class="line"> <span class="keyword">lambda</span> x: &#123;<span class="string">&quot;review&quot;</span>: [html.unescape(o) <span class="keyword">for</span> o <span class="keyword">in</span> x[<span class="string">&quot;review&quot;</span>]]&#125;, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‚¨è¿è¡Œæ­¤ä»£ç ï¼Œæ‚¨ä¼šçœ‹åˆ°æ­¤å‘½ä»¤çš„æ‰§è¡Œé€Ÿåº¦æ¯”å‰ä¸€ä¸ªå‘½ä»¤å¿«å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºåˆ—è¡¨æ¨å¯¼å¼é€šå¸¸æ¯”åœ¨åŒä¸€ä»£ç ä¸­ç”¨ <strong>for</strong> å¾ªç¯æ‰§è¡Œç›¸åŒçš„ä»£ç æ›´å¿«ï¼Œå¹¶ä¸”æˆ‘ä»¬è¿˜é€šè¿‡åŒæ—¶è®¿é—®å¤šä¸ªå…ƒç´ è€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªæ¥å¤„ç†æ¥æé«˜å¤„ç†çš„é€Ÿåº¦ã€‚</p>
</blockquote>
<p><font size="5">å¿«é€Ÿåˆ†è¯å™¨ï¼š</font></p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨å¿«é€Ÿæ ‡è®°å™¨æ ‡è®°æ‰€æœ‰è¯ç‰©è¯„è®ºï¼ˆ<strong>AutoTokenizer</strong> çš„é»˜è®¤è®¾ç½®æ˜¯<strong>use_fast=True</strong>ï¼Œä¹Ÿå°±æ˜¯å¿«é€Ÿæ ‡è®°ï¼Œå¯ä»¥è®¾ç½®use_fast=Trueæ¥å¯¹æ¯”é€Ÿåº¦ã€‚ä»–ä»¬èƒ½å¤Ÿå®ç°è¿™æ ·çš„åŠ é€Ÿï¼Œå› ä¸ºåœ¨åº•å±‚çš„æ ‡è®°åŒ–ä»£ç æ˜¯åœ¨ Rust ä¸­æ‰§è¡Œçš„ï¼ŒRust æ˜¯ä¸€ç§å¯ä»¥è½»æ¾å¹¶è¡ŒåŒ–æ‰§è¡Œçš„è¯­è¨€ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_function</span>(<span class="params">examples</span>):</span><br><span class="line"> <span class="keyword">return</span> tokenizer(examples[<span class="string">&quot;review&quot;</span>], truncation=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚ä½ åœ¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter3">ç¬¬ä¸‰ç« </a>æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬åŸæœ¬å°±å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªç¤ºä¾‹ä¼ é€’ç»™åˆ†è¯å™¨ï¼Œå› æ­¤åœ¨<strong>batched=True</strong>æ˜¯ä¸€ä¸ªéå¿…é¡»çš„é€‰é¡¹ã€‚åœ¨ç¬”è®°æœ¬ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨è¦æµ‹é‡çš„ä»£ç è¡Œä¹‹å‰æ·»åŠ  <strong>%time</strong>æ¥æµ‹è¯•æ”¹è¡Œè¿è¡Œæ‰€æ¶ˆè€—çš„æ—¶é—´ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%time tokenized_dataset = drug_dataset.<span class="built_in">map</span>(tokenize_function, batched=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p><font size="5">å¤šçº¿ç¨‹å¤„ç†</font></p>
<blockquote>
<p><strong>Dataset.map()</strong> ä¹Ÿæœ‰ä¸€äº›è‡ªå·±çš„å¹¶è¡ŒåŒ–èƒ½åŠ›ã€‚ç”±äºå®ƒä»¬ä¸å— Rust çš„æ”¯æŒï¼Œå› æ­¤æ…¢é€Ÿåˆ†è¯å™¨çš„é€Ÿåº¦èµ¶ä¸ä¸Šå¿«é€Ÿåˆ†è¯å™¨ï¼Œä½†å®ƒä»¬ä»ç„¶ä¼šæ›´å¿«ä¸€äº›ï¼ˆå°¤å…¶æ˜¯å½“æ‚¨ä½¿ç”¨æ²¡æœ‰å¿«é€Ÿç‰ˆæœ¬çš„åˆ†è¯å™¨æ—¶ï¼‰ã€‚è¦å¯ç”¨å¤šå¤„ç†ï¼Œè¯·åœ¨**Dataset.map()**æ—¶ä½¿ç”¨ <strong>num_proc</strong> å‚æ•°å¹¶æŒ‡å®šè¦åœ¨è°ƒç”¨ä¸­ä½¿ç”¨çš„è¿›ç¨‹æ•° ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">slow_tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;bert-base-cased&quot;</span>, use_fast=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slow_tokenize_function</span>(<span class="params">examples</span>):</span><br><span class="line"> <span class="keyword">return</span> slow_tokenizer(examples[<span class="string">&quot;review&quot;</span>], truncation=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tokenized_dataset = drug_dataset.<span class="built_in">map</span>(slow_tokenize_function, batched=<span class="literal">True</span>, num_proc=<span class="number">8</span>)</span><br></pre></td></tr></table></figure>
<p>PSï¼šé™¤äº† <strong>num_proc=8</strong>ï¼Œæˆ‘ä»¬çš„æµ‹è¯•è¡¨æ˜ï¼Œä½¿ç”¨<strong>batched=True</strong>è€Œä¸å¸¦æœ‰<strong>num_proc</strong>å‚æ•°çš„é€‰é¡¹å¤„ç†èµ·æ¥æ›´å¿«ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä¸å»ºè®®å°† Python å¤šçº¿ç¨‹å¤„ç†ç”¨äºå…·æœ‰<strong>batched=True</strong>åŠŸèƒ½çš„å¿«é€Ÿæ ‡è®°å™¨ .</p>
</blockquote>
<p><font size="5">ä»å•ä¸ªç¤ºä¾‹çš„ä¸€åˆ—ä¸­æå–å¤šä¸ªç‰¹å¾</font></p>
<p><strong>ä¸€ä¸ªä¾‹å­é€šå¸¸å¯ä»¥ä¸ºæˆ‘ä»¬çš„æ¨¡å‹æä¾›ä¸€ç»„ç‰¹å¾ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›ç‰¹å¾ä¼šå‚¨å­˜åœ¨æ•°æ®é›†çš„å‡ ä¸ªåˆ—ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚æ­¤å¤„çš„ä¾‹å­å’Œç”¨äºé—®ç­”çš„æ•°æ®ï¼‰ï¼Œå¯ä»¥ä»å•ä¸ªç¤ºä¾‹çš„ä¸€åˆ—ä¸­æå–å¤šä¸ªç‰¹å¾</strong></p>
<blockquote>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ ‡è®°åŒ–æˆ‘ä»¬çš„ç¤ºä¾‹å¹¶å°†æœ€å¤§æˆªæ–­é•¿åº¦è®¾ç½®128ï¼Œä½†æˆ‘ä»¬å°†è¦æ±‚æ ‡è®°å™¨è¿”å›å…¨éƒ¨æ–‡æœ¬å—ï¼Œè€Œä¸ä»…ä»…æ˜¯ç¬¬ä¸€ä¸ªã€‚è¿™å¯ä»¥ç”¨ <strong>return_overflowing_tokens=True</strong> ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_and_split</span>(<span class="params">examples</span>):</span><br><span class="line"> <span class="keyword">return</span> tokenizer(</span><br><span class="line">     examples[<span class="string">&quot;review&quot;</span>],</span><br><span class="line">     truncation=<span class="literal">True</span>,</span><br><span class="line">     max_length=<span class="number">128</span>,</span><br><span class="line">     return_overflowing_tokens=<span class="literal">True</span>,</span><br><span class="line"> )</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨<strong>Dataset.map()</strong> æ­£å¼åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šå¼€å§‹å¤„ç†ä¹‹å‰è®©æˆ‘ä»¬å…ˆåœ¨ä¸€ä¸ªä¾‹å­ä¸Šæµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">result = tokenize_and_split(drug_dataset[<span class="string">&quot;train&quot;</span>][<span class="number">0</span>])</span><br><span class="line">[<span class="built_in">len</span>(inp) <span class="keyword">for</span> inp <span class="keyword">in</span> result[<span class="string">&quot;input_ids&quot;</span>]]</span><br><span class="line"></span><br><span class="line">[<span class="number">128</span>, <span class="number">49</span>]</span><br></pre></td></tr></table></figure>
<p><font color="red">æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸­çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹å˜æˆäº†ä¸¤ä¸ªç‰¹å¾ï¼Œå› ä¸ºå®ƒè¢«æ ‡è®°ä¸ºè¶…è¿‡æˆ‘ä»¬æŒ‡å®šçš„æœ€å¤§æˆªæ–­é•¿åº¦ï¼Œå› æ­¤ç»“æœè¢«æˆªæˆäº†ä¸¤æ®µï¼šç¬¬ä¸€æ®µé•¿åº¦ä¸º 128 ï¼Œç¬¬äºŒæ®µé•¿åº¦ä¸º 49 ã€‚</font>ç°åœ¨è®©æˆ‘ä»¬å¯¹æ‰€æœ‰å…ƒç´ æ‰§è¡Œæ­¤æ“ä½œæ•°æ®é›†ï¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tokenized_dataset = drug_dataset.<span class="built_in">map</span>(tokenize_and_split, batched=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">ArrowInvalid: Column <span class="number">1</span> named condition expected length <span class="number">1463</span> but got length <span class="number">1000</span></span><br></pre></td></tr></table></figure>
<p>ä¸å¥½äº†ï¼å®ƒæ²¡æœ‰èµ·ä½œç”¨ï¼ä¸ºä»€ä¹ˆå‘¢ï¼ŸæŸ¥çœ‹é”™è¯¯æ¶ˆæ¯ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªçº¿ç´¢ï¼šåˆ—çš„é•¿åº¦ä¸åŒ¹é…ï¼Œä¸€åˆ—é•¿åº¦ä¸º 1,463ï¼Œå¦ä¸€åˆ—é•¿åº¦ä¸º 1,000ã€‚1,000è¡Œçš„â€reviewâ€ç»™å‡ºäº† 1,463 è¡Œçš„æ–°ç‰¹å¾ï¼Œå¯¼è‡´å’ŒåŸæœ¬çš„1000è¡Œæ•°æ®ä¸åŒ¹é…ã€‚</p>
<p><font color="red">é—®é¢˜å‡ºåœ¨æˆ‘ä»¬è¯•å›¾æ··åˆä¸¤ä¸ªä¸åŒå¤§å°çš„ä¸åŒæ•°æ®é›†ï¼š <strong>drug_dataset</strong> åˆ—å°†æœ‰ä¸€å®šæ•°é‡çš„å…ƒç´ ï¼ˆæˆ‘ä»¬é”™è¯¯ä¸­çš„ 1,000ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£åœ¨æ„å»º<strong>tokenized_dataset</strong> å°†æœ‰æ›´å¤šçš„å…ƒç´ ï¼ˆé”™è¯¯æ¶ˆæ¯ä¸­çš„ 1,463ï¼‰ã€‚è¿™ä¸é€‚ç”¨äº <strong>Dataset</strong> ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»æ—§æ•°æ®é›†ä¸­åˆ é™¤åˆ—æˆ–ä½¿å®ƒä»¬çš„å¤§å°ä¸æ–°æ•°æ®é›†ä¸­çš„å¤§å°ç›¸åŒã€‚</font>æˆ‘ä»¬å¯ä»¥ç”¨ <strong>remove_columns</strong> å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tokenized_dataset = drug_dataset.<span class="built_in">map</span>(</span><br><span class="line"> tokenize_and_split, batched=<span class="literal">True</span>, remove_columns=drug_dataset[<span class="string">&quot;train&quot;</span>].column_names</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨è¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯”è¾ƒé•¿åº¦æ¥æ£€æŸ¥æ–°æ•°æ®é›†çš„å…ƒç´ æ˜¯å¦æ¯”åŸå§‹æ•°æ®é›†å¤šå¾—å¤šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(tokenized_dataset[<span class="string">&quot;train&quot;</span>]), <span class="built_in">len</span>(drug_dataset[<span class="string">&quot;train&quot;</span>])</span><br><span class="line">(<span class="number">206772</span>, <span class="number">138514</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p><font size="5">é•¿åº¦ä¸åŒ¹é…çš„é—®é¢˜</font></p>
<blockquote>
<p>å¯ä»¥é€šè¿‡ä½¿æ—§åˆ—ä¸æ–°åˆ—çš„å¤§å°ç›¸åŒæ¥å¤„ç†é•¿åº¦ä¸åŒ¹é…çš„é—®é¢˜ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>overflow_to_sample_mapping</strong> å­—æ®µï¼Œå½“æˆ‘ä»¬è®¾ç½®<strong>return_overflowing_tokens=True</strong> .å®ƒä¸ºæˆ‘ä»¬æä¾›äº†ç‰¹å¾åˆ°å®ƒæ‰€äº§ç”Ÿçš„æ ·æœ¬çš„æ˜ å°„ã€‚ä½¿ç”¨è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸå§‹æ•°æ®é›†ä¸­çš„æ¯ä¸ªé”®å…³è”åˆ°ä¸€ä¸ªåˆé€‚å¤§å°çš„å€¼åˆ—è¡¨ä¸­ï¼Œé€šè¿‡éå†æ‰€æœ‰çš„æ•°æ®æ¥ç”Ÿæˆæ–°ç‰¹æ€§:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_and_split</span>(<span class="params">examples</span>):</span><br><span class="line"> result = tokenizer(</span><br><span class="line">     examples[<span class="string">&quot;review&quot;</span>],</span><br><span class="line">     truncation=<span class="literal">True</span>,</span><br><span class="line">     max_length=<span class="number">128</span>,</span><br><span class="line">     return_overflowing_tokens=<span class="literal">True</span>,</span><br><span class="line"> )</span><br><span class="line"> <span class="comment"># Extract mapping between new and old indices</span></span><br><span class="line"> sample_map = result.pop(<span class="string">&quot;overflow_to_sample_mapping&quot;</span>)</span><br><span class="line"> <span class="keyword">for</span> key, values <span class="keyword">in</span> examples.items():</span><br><span class="line">     result[key] = [values[i] <span class="keyword">for</span> i <span class="keyword">in</span> sample_map]</span><br><span class="line"> <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨**Dataset.map()**æ¥è¿›è¡Œæ‰¹å¤„ç†ï¼Œè¿™æ ·æ— éœ€æˆ‘ä»¬åˆ é™¤æ—§åˆ—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tokenized_dataset = drug_dataset.<span class="built_in">map</span>(tokenize_and_split, batched=<span class="literal">True</span>)</span><br><span class="line">tokenized_dataset</span><br><span class="line">DatasetDict(&#123;</span><br><span class="line"> train: Dataset(&#123;</span><br><span class="line">     features: [<span class="string">&#x27;attention_mask&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;input_ids&#x27;</span>, <span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>, <span class="string">&#x27;token_type_ids&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>],</span><br><span class="line">     num_rows: <span class="number">206772</span></span><br><span class="line"> &#125;)</span><br><span class="line"> test: Dataset(&#123;</span><br><span class="line">     features: [<span class="string">&#x27;attention_mask&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;input_ids&#x27;</span>, <span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>, <span class="string">&#x27;token_type_ids&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>],</span><br><span class="line">     num_rows: <span class="number">68876</span></span><br><span class="line"> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è·å¾—äº†ä¸ä»¥å‰ç›¸åŒæ•°é‡çš„è®­ç»ƒç‰¹å¾ï¼Œä½†åœ¨è¿™é‡Œæˆ‘ä»¬ä¿ç•™äº†æ‰€æœ‰æ—§å­—æ®µã€‚<font color="red">å¦‚æœæ‚¨åœ¨ä½¿ç”¨æ¨¡å‹è®¡ç®—ä¹‹åéœ€è¦å®ƒä»¬è¿›è¡Œä¸€äº›åå¤„ç†ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</font></p>
</blockquote>
<h3 id="4datasetså’Œdataframesçš„ç›¸äº’è½¬æ¢"><a class="markdownIt-Anchor" href="#4datasetså’Œdataframesçš„ç›¸äº’è½¬æ¢"></a> 4.Datasetså’ŒDataFramesçš„ç›¸äº’è½¬æ¢</h3>
<p><font size="5">Dataset.set_format() </font></p>
<p>ä¸ºäº†å®ç°å„ç§ç¬¬ä¸‰æ–¹åº“ä¹‹é—´çš„è½¬æ¢ï¼ŒğŸ¤— Datasets æä¾›äº†ä¸€ä¸ª <strong>Dataset.set_format()</strong> åŠŸèƒ½ã€‚æ­¤åŠŸèƒ½å¯ä»¥é€šè¿‡ä»…æ›´æ”¹è¾“å‡ºæ ¼å¼çš„ï¼Œè½»æ¾åˆ‡æ¢åˆ°å¦ä¸€ç§æ ¼å¼ï¼Œè€Œä¸ä¼šå½±å“åº•å±‚æ•°æ®æ ¼å¼ï¼Œå³ Apache Arrowã€‚æ ¼å¼åŒ–ä¼šåœ¨æ•°æ®æœ¬èº«ä¸Šè¿›è¡Œã€‚ä¸ºäº†æ¼”ç¤ºï¼Œè®©æˆ‘ä»¬å°†æ•°æ®é›†è½¬æ¢ä¸º Pandasï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset.set_format(<span class="string">&quot;pandas&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬è®¿é—®æ•°æ®é›†çš„å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª <strong>pandas.DataFrame</strong> è€Œä¸æ˜¯å­—å…¸ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset[<span class="string">&quot;train&quot;</span>][:<span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>patient_id</th>
<th>drugName</th>
<th>condition</th>
<th>review</th>
<th>rating</th>
<th>date</th>
<th>usefulCount</th>
<th>review_length</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>95260</td>
<td>Guanfacine</td>
<td>adhd</td>
<td>â€œMy son is halfway through his fourth week of Intunivâ€¦â€</td>
<td>8.0</td>
<td>April 27, 2010</td>
<td>192</td>
<td>141</td>
</tr>
<tr>
<td>1</td>
<td>92703</td>
<td>Lybrel</td>
<td>birth control</td>
<td>â€œI used to take another oral contraceptive, which had 21 pill cycle, and was very happy- very light periods, max 5 days, no other side effectsâ€¦â€</td>
<td>5.0</td>
<td>December 14, 2009</td>
<td>17</td>
<td>134</td>
</tr>
<tr>
<td>2</td>
<td>138000</td>
<td>Ortho Evra</td>
<td>birth control</td>
<td>â€œThis is my first time using any form of birth controlâ€¦â€</td>
<td>8.0</td>
<td>November 3, 2015</td>
<td>10</td>
<td>89</td>
</tr>
</tbody>
</table>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <strong>pandas.DataFrame</strong> æ¥é€‰æ‹© <strong>drug_dataset[train]</strong> çš„æ‰€æœ‰å…ƒç´ ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_df = drug_dataset[<span class="string">&quot;train&quot;</span>][:]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸš¨ åœ¨åº•å±‚ï¼Œ<code>Dataset.set_format()</code> æ”¹å˜äº†æ•°æ®é›†çš„ <code>__getitem__()</code> dunder æ–¹æ³•çš„è¿”å›æ ¼å¼ã€‚ è¿™æ„å‘³ç€å½“æˆ‘ä»¬æƒ³ä» <code>&quot;pandas&quot;</code> æ ¼å¼çš„ <code>Dataset</code> ä¸­åˆ›å»ºåƒ <code>train_df</code> è¿™æ ·çš„æ–°å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œåˆ‡ç‰‡ä»¥è·å¾— <code>pandas.DataFrame</code>ã€‚</p>
<p>æ— è®ºè¾“å‡ºæ ¼å¼å¦‚ä½•ï¼Œæ‚¨éƒ½å¯ä»¥è‡ªå·±éªŒè¯ <code>drug_dataset[&quot;train&quot;]</code> çš„ç±»å‹ä¾ç„¶è¿˜æ˜¯ <code>Dataset</code>ã€‚</p>
</blockquote>
<p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬æƒ³è¦çš„æ‰€æœ‰ Pandas åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡èŠ±å¼é“¾æ¥æ¥è®¡ç®— <strong>condition</strong>ç±»ä¹‹é—´çš„åˆ†å¸ƒ ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">frequencies = (</span><br><span class="line">    train_df[<span class="string">&quot;condition&quot;</span>]</span><br><span class="line">    .value_counts()</span><br><span class="line">    .to_frame()</span><br><span class="line">    .reset_index()</span><br><span class="line">    .rename(columns=&#123;<span class="string">&quot;index&quot;</span>: <span class="string">&quot;condition&quot;</span>, <span class="string">&quot;condition&quot;</span>: <span class="string">&quot;frequency&quot;</span>&#125;)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">frequencies.head()</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>condition</th>
<th>frequency</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>birth control</td>
<td>27655</td>
</tr>
<tr>
<td>1</td>
<td>depression</td>
<td>8023</td>
</tr>
<tr>
<td>2</td>
<td>acne</td>
<td>5209</td>
</tr>
<tr>
<td>3</td>
<td>anxiety</td>
<td>4991</td>
</tr>
<tr>
<td>4</td>
<td>pain</td>
<td>4744</td>
</tr>
</tbody>
</table>
<p>ä¸€æ—¦æˆ‘ä»¬å®Œæˆäº† Pandas åˆ†æï¼Œæˆ‘ä»¬æ€»æ˜¯é€šè¿‡ä½¿ç”¨å¯¹è±¡ **Dataset.from_pandas()**æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>Dataset</strong> å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">freq_dataset = Dataset.from_pandas(frequencies)</span><br><span class="line">freq_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;frequency&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">819</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><font size="5">Dataset.reset_format()</font></p>
<p>é‡ç½®æ ¼å¼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset.reset_format()</span><br></pre></td></tr></table></figure>
<h3 id="5åˆ›å»ºéªŒè¯é›†"><a class="markdownIt-Anchor" href="#5åˆ›å»ºéªŒè¯é›†"></a> 5.åˆ›å»ºéªŒè¯é›†</h3>
<p>å°½ç®¡æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä»¥ç”¨äºè¯„ä¼°çš„æµ‹è¯•é›†ï¼Œä½†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¿æŒæµ‹è¯•é›†ä¸å˜å¹¶åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„éªŒè¯é›†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚ä¸€æ—¦æ‚¨å¯¹æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°æ„Ÿåˆ°æ»¡æ„ï¼Œæ‚¨å°±å¯ä»¥å¯¹éªŒè¯é›†è¿›è¡Œæœ€ç»ˆçš„æ£€æŸ¥ã€‚æ­¤è¿‡ç¨‹æœ‰åŠ©äºé™ä½æ‚¨è¿‡æ‹Ÿåˆæµ‹è¯•é›†å¹¶éƒ¨ç½²åœ¨ç°å®ä¸–ç•Œæ•°æ®ä¸Šå¤±è´¥çš„æ¨¡å‹çš„é£é™©ã€‚</p>
<p><font size="5">Dataset.train_test_split()</font></p>
<p>Datasetsæä¾›äº†ä¸€ä¸ªåŸºäº<strong>scikit-learn</strong>çš„ç»å…¸æ–¹æ³•<strong>Dataset.train_test_split()</strong> .è®©æˆ‘ä»¬ç”¨å®ƒæŠŠæˆ‘ä»¬çš„è®­ç»ƒé›†åˆ†æˆ <strong>train</strong> å’Œ <strong>validation</strong> ï¼ˆä¸ºäº†å¯ä»¥å¤ç°ï¼Œæˆ‘ä»¬å°†è®¾ç½®<strong>seed</strong>çš„å€¼ä¸ºä¸€ä¸ªå¸¸é‡ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset_clean = drug_dataset[<span class="string">&quot;train&quot;</span>].train_test_split(train_size=<span class="number">0.8</span>, seed=<span class="number">42</span>) <span class="comment">#  å°†åŸè®­ç»ƒé›†çš„0.8ä½œä¸ºæ–°è®­ç»ƒé›†ï¼Œ0.2ä½œä¸ºæ–°æµ‹è¯•é›†</span></span><br><span class="line"><span class="comment"># Rename the default &quot;test&quot; split to &quot;validation&quot;</span></span><br><span class="line">drug_dataset_clean[<span class="string">&quot;validation&quot;</span>] = drug_dataset_clean.pop(<span class="string">&quot;test&quot;</span>) <span class="comment"># å°†æ–°çš„æµ‹è¯•é›†ä½œä¸ºéªŒè¯é›†</span></span><br><span class="line"><span class="comment"># Add the &quot;test&quot; set to our `DatasetDict`</span></span><br><span class="line">drug_dataset_clean[<span class="string">&quot;test&quot;</span>] = drug_dataset[<span class="string">&quot;test&quot;</span>] <span class="comment"># å°†åŸæµ‹è¯•é›†ä½œä¸ºæ–°çš„æµ‹è¯•é›†</span></span><br><span class="line">drug_dataset_clean</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DatasetDict(&#123;</span><br><span class="line">    train: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>, <span class="string">&#x27;review_clean&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">110811</span></span><br><span class="line">    &#125;)</span><br><span class="line">    validation: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>, <span class="string">&#x27;review_clean&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">27703</span></span><br><span class="line">    &#125;)</span><br><span class="line">    test: Dataset(&#123;</span><br><span class="line">        features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>, <span class="string">&#x27;review_clean&#x27;</span>],</span><br><span class="line">        num_rows: <span class="number">46108</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="6ä¿å­˜æ•°æ®é›†"><a class="markdownIt-Anchor" href="#6ä¿å­˜æ•°æ®é›†"></a> 6.ä¿å­˜æ•°æ®é›†</h3>
<p>Datasets æä¾›äº†ä¸‰ä¸ªä¸»è¦åŠŸèƒ½æ¥ä»¥ä¸åŒçš„æ ¼å¼ä¿å­˜æ‚¨çš„æ•°æ®é›†ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°æ®æ ¼å¼</th>
<th>å¯¹åº”çš„æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td>Arrow</td>
<td><code>Dataset.save_to_disk()</code></td>
</tr>
<tr>
<td>CSV</td>
<td><code>Dataset.to_csv()</code></td>
</tr>
<tr>
<td>JSON</td>
<td><code>Dataset.to_json()</code></td>
</tr>
</tbody>
</table>
<p><font size="5">Arrow æ ¼å¼</font></p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ä»¥ <strong>Arrow æ ¼å¼</strong>ä¿å­˜æˆ‘ä»¬æ¸…æ´—è¿‡çš„æ•°æ®é›†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drug_dataset_clean.save_to_disk(<span class="string">&quot;drug-reviews&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ç»“æ„çš„ç›®å½•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">drug-reviews/</span><br><span class="line">â”œâ”€â”€ dataset_dict.json</span><br><span class="line">â”œâ”€â”€ test</span><br><span class="line">â”‚   â”œâ”€â”€ dataset.arrow</span><br><span class="line">â”‚   â”œâ”€â”€ dataset_info.json</span><br><span class="line">â”‚   â””â”€â”€ state.json</span><br><span class="line">â”œâ”€â”€ train</span><br><span class="line">â”‚   â”œâ”€â”€ dataset.arrow</span><br><span class="line">â”‚   â”œâ”€â”€ dataset_info.json</span><br><span class="line">â”‚   â”œâ”€â”€ indices.arrow</span><br><span class="line">â”‚   â””â”€â”€ state.json</span><br><span class="line">â””â”€â”€ validation</span><br><span class="line"> â”œâ”€â”€ dataset.arrow</span><br><span class="line"> â”œâ”€â”€ dataset_info.json</span><br><span class="line"> â”œâ”€â”€ indices.arrow</span><br><span class="line"> â””â”€â”€ state.json</span><br></pre></td></tr></table></figure>
<p>åœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªéƒ¨åˆ†.arrowè¡¨ï¼Œä»¥åŠä¸€äº›å…ƒæ•°æ®æ•°æ®é›†ä¿¡æ¯.jsonå’ŒçŠ¶æ€æ–‡ä»¶ä¿å­˜åœ¨ä¸€èµ·.<font color="red">æ‚¨å¯ä»¥å°† Arrow æ ¼å¼è§†ä¸ºä¸€ä¸ªç²¾ç¾çš„åˆ—å’Œè¡Œçš„è¡¨æ ¼ï¼Œå®ƒé’ˆå¯¹æ„å»ºå¤„ç†å’Œä¼ è¾“å¤§å‹æ•°æ®é›†çš„é«˜æ€§èƒ½åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ã€‚</font></p>
<p><font size="5">load_from_disk() </font></p>
<p>ä¿å­˜æ•°æ®é›†åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>load_from_disk()</strong> åŠŸèƒ½ä»ç£ç›˜è¯»å–æ•°æ®å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_from_disk</span><br><span class="line"></span><br><span class="line">drug_dataset_reloaded = load_from_disk(<span class="string">&quot;drug-reviews&quot;</span>)</span><br><span class="line">drug_dataset_reloaded</span><br><span class="line"></span><br><span class="line">DatasetDict(&#123;</span><br><span class="line"> train: Dataset(&#123;</span><br><span class="line">     features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>],</span><br><span class="line">     num_rows: <span class="number">110811</span></span><br><span class="line"> &#125;)</span><br><span class="line"> validation: Dataset(&#123;</span><br><span class="line">     features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>],</span><br><span class="line">     num_rows: <span class="number">27703</span></span><br><span class="line"> &#125;)</span><br><span class="line"> test: Dataset(&#123;</span><br><span class="line">     features: [<span class="string">&#x27;patient_id&#x27;</span>, <span class="string">&#x27;drugName&#x27;</span>, <span class="string">&#x27;condition&#x27;</span>, <span class="string">&#x27;review&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;usefulCount&#x27;</span>, <span class="string">&#x27;review_length&#x27;</span>],</span><br><span class="line">     num_rows: <span class="number">46108</span></span><br><span class="line"> &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</blockquote>
<p><font size="5">CSV å’Œ JSON æ ¼å¼</font></p>
<blockquote>
<p>å¯¹äº CSV å’Œ JSON æ ¼å¼ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ¯ä¸ªéƒ¨åˆ†å­˜å‚¨ä¸ºå•ç‹¬çš„æ–‡ä»¶ã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿­ä»£<strong>DatasetDict</strong>ä¸­çš„é”®å’Œå€¼ ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> split, dataset <span class="keyword">in</span> drug_dataset_clean.items():</span><br><span class="line"> dataset.to_json(<span class="string">f&quot;drug-reviews-<span class="subst">&#123;split&#125;</span>.jsonl&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™å°†ä¿å­˜æ¯ä¸ªæ‹†åˆ†éƒ½æ˜¯<a target="_blank" rel="noopener" href="https://jsonlines.org/">JSONçš„æ ‡å‡†æ ¼å¼</a>ï¼Œå…¶ä¸­æ•°æ®é›†ä¸­çš„æ¯ä¸€è¡Œéƒ½å­˜å‚¨ä¸ºä¸€è¡Œ JSONã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!head -n <span class="number">1</span> drug-reviews-train.jsonl</span><br><span class="line">&#123;<span class="string">&quot;patient_id&quot;</span>:<span class="number">141780</span>,<span class="string">&quot;drugName&quot;</span>:<span class="string">&quot;Escitalopram&quot;</span>,<span class="string">&quot;condition&quot;</span>:<span class="string">&quot;depression&quot;</span>,<span class="string">&quot;review&quot;</span>:<span class="string">&quot;\&quot;I seemed to experience the regular side effects of LEXAPRO, insomnia, low sex drive, sleepiness during the day. I am taking it at night because my doctor said if it made me tired to take it at night. I assumed it would and started out taking it at night. Strange dreams, some pleasant. I was diagnosed with fibromyalgia. Seems to be helping with the pain. Have had anxiety and depression in my family, and have tried quite a few other medications that haven&#x27;t worked. Only have been on it for two weeks but feel more positive in my mind, want to accomplish more in my life. Hopefully the side effects will dwindle away, worth it to stick with it from hearing others responses. Great medication.\&quot;&quot;</span>,<span class="string">&quot;rating&quot;</span>:<span class="number">9.0</span>,<span class="string">&quot;date&quot;</span>:<span class="string">&quot;May 29, 2011&quot;</span>,<span class="string">&quot;usefulCount&quot;</span>:<span class="number">10</span>,<span class="string">&quot;review_length&quot;</span>:<span class="number">125</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter5/2">ç¬¬äºŒèŠ‚</a>å­¦è¿‡çš„æŠ€æœ¯åŠ è½½ JSON æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data_files = &#123;</span><br><span class="line"> <span class="string">&quot;train&quot;</span>: <span class="string">&quot;drug-reviews-train.jsonl&quot;</span>,</span><br><span class="line"> <span class="string">&quot;validation&quot;</span>: <span class="string">&quot;drug-reviews-validation.jsonl&quot;</span>,</span><br><span class="line"> <span class="string">&quot;test&quot;</span>: <span class="string">&quot;drug-reviews-test.jsonl&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">drug_dataset_reloaded = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files)</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="datasetsç”¨äºå¤§æ¨¡å‹"><a class="markdownIt-Anchor" href="#datasetsç”¨äºå¤§æ¨¡å‹"></a> Datasetsç”¨äºå¤§æ¨¡å‹</h2>
<p>Datasets æ—¨åœ¨å…‹æœåŠ è½½æå¤§æ•°æ®é›†çš„å­˜å‚¨é™åˆ¶ã€‚å®ƒé€šè¿‡å°†æ•°æ®é›†ä½œä¸ºå†…å­˜æ˜ å°„æ–‡ä»¶æ¥å¤„ç†ï¼Œå¹¶é€šè¿‡åœ¨è¯­æ–™åº“ä¸­æµåŒ–æ¡ç›®æ¥æ‘†è„±ç¡¬ç›˜é™åˆ¶, ä»è€Œä½¿ä½ é¿å…å†…å­˜ç®¡ç†é—®é¢˜ã€‚</p>
<h3 id="1pile"><a class="markdownIt-Anchor" href="#1pile"></a> 1.Pile</h3>
<p>The Pile æ˜¯ç”±<a target="_blank" rel="noopener" href="https://www.eleuther.ai/">EleutherAI</a>åˆ›å»ºçš„ä¸€ä¸ªè‹±è¯­æ–‡æœ¬è¯­æ–™åº“, ç”¨äºè®­ç»ƒå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹ã€‚å®ƒåŒ…å«å„ç§å„æ ·çš„æ•°æ®é›†, æ¶µç›–ç§‘å­¦æ–‡ç« , GitHub ä»£ç åº“ä»¥åŠè¿‡æ»¤çš„Webæ–‡æœ¬ã€‚è®­ç»ƒè¯­æ–™åº“åœ¨<a target="_blank" rel="noopener" href="https://the-eye.eu/public/AI/pile/">14 GB chunks</a>, å¹¶ä¸”ä½ ä¹Ÿå¯ä»¥ä¸‹è½½å‡ ä¸ª<a target="_blank" rel="noopener" href="https://the-eye.eu/public/AI/pile_preliminary_components/">å•ç‹¬çš„ç»„ä»¶</a>ã€‚ è®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ PubMed Abstracts æ•°æ®é›†, å®ƒæ˜¯<a target="_blank" rel="noopener" href="https://pubmed.ncbi.nlm.nih.gov/">PubMed</a>ä¸Šçš„1500ä¸‡ç¯‡ç”Ÿç‰©åŒ»å­¦å‡ºç‰ˆç‰©çš„æ‘˜è¦çš„è¯­æ–™åº“ã€‚ æ•°æ®é›†é‡‡ç”¨<a target="_blank" rel="noopener" href="https://jsonlines.org/">JSONè¡Œæ ¼å¼</a> å¹¶ä½¿ç”¨<code>zstandard</code>åº“è¿›è¡Œå‹ç¼©, æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆå®‰è£…<code>zstandard</code>åº“:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install zstandard</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter5/2">ç¬¬äºŒèŠ‚</a>ä¸­æ‰€å­¦çš„åŠ è½½è¿œç¨‹æ•°æ®é›†çš„æ–¹æ³•åŠ è½½æ•°æ®é›†:</p>
<p><font color="red">æ³¨æ„è¯¥æ•°æ®é›†é“¾æ¥å·²ç»ä¸èƒ½ç”¨äº†</font></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># This takes a few minutes to run, so go grab a tea or coffee while you wait :)</span></span><br><span class="line">data_files = <span class="string">&quot;https://the-eye.eu/public/AI/pile_preliminary_components/PUBMED_title_abstracts_2019_baseline.jsonl.zst&quot;</span></span><br><span class="line">pubmed_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">pubmed_dataset</span><br><span class="line"></span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;meta&#x27;</span>, <span class="string">&#x27;text&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">15518009</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®é›†ä¸­æœ‰ 15,518,009 è¡Œå’Œ 2 åˆ— â€” è¿™æ˜¯éå¸¸å¤šçš„!</p>
<blockquote>
<p>âœ é»˜è®¤æƒ…å†µä¸‹, ğŸ¤— Datasets ä¼šè‡ªåŠ¨è§£å‹åŠ è½½æ•°æ®é›†æ‰€éœ€çš„æ–‡ä»¶ã€‚ å¦‚æœä½ æƒ³ä¿ç•™ç¡¬ç›˜ç©ºé—´, ä½ å¯ä»¥ä¼ é€’ <code>DownloadConfig(delete_extracted=True)</code> åˆ° <code>download_config</code> çš„ <code>load_dataset()</code>å‚æ•°. æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯, è¯·å‚é˜…æ–‡æ¡£](<a target="_blank" rel="noopener" href="https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig">https://huggingface.co/docs/datasets/package_reference/builder_classes#datasets.DownloadConfig</a>)ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æ•°æ®é›†çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å†…å®¹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pubmed_dataset[<span class="number">0</span>]</span><br><span class="line">&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409574</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°, è¿™çœ‹èµ·æ¥åƒæ˜¯åŒ»å­¦æ–‡ç« çš„æ‘˜è¦ã€‚ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬ä½¿ç”¨äº†RAMçš„å¤šå°‘å­˜å‚¨ç©ºé—´æ¥åŠ è½½æ•°æ®é›†!</p>
<h3 id="2å†…å­˜æ˜ å°„"><a class="markdownIt-Anchor" href="#2å†…å­˜æ˜ å°„"></a> 2.å†…å­˜æ˜ å°„</h3>
<p>åœ¨ Python ä¸­æµ‹é‡å†…å­˜ä½¿ç”¨æƒ…å†µçš„ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨<a target="_blank" rel="noopener" href="https://psutil.readthedocs.io/en/latest/"><code>psutil</code></a>åº“,å®ƒå¯ä»¥ä½¿ç”¨ <code>pip</code>å®‰è£…, å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install psutil</span><br></pre></td></tr></table></figure>
<p>å®ƒæä¾›äº†ä¸€ä¸ª <code>Process</code> ç±»,è¿™ä¸ªç±»å…è®¸æˆ‘ä»¬æ£€æŸ¥å½“å‰è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µ, å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> psutil</span><br><span class="line"></span><br><span class="line"><span class="comment"># Process.memory_info is expressed in bytes, so convert to megabytes</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;RAM used: <span class="subst">&#123;psutil.Process().memory_info().rss / (<span class="number">1024</span> * <span class="number">1024</span>):<span class="number">.2</span>f&#125;</span> MB&quot;</span>)</span><br><span class="line"></span><br><span class="line">RAM used: <span class="number">5678.33</span> MB</span><br></pre></td></tr></table></figure>
<p><font color="red">è¿™é‡Œçš„<code>rss</code>å±æ€§æ˜¯æŒ‡<strong>å¸¸é©»é›†</strong>çš„å¤§å°, å®ƒæ˜¯è¿›ç¨‹åœ¨RAMä¸­å ç”¨çš„å†…å­˜æ¯”ä¾‹ã€‚ è¿™ä¸ªæµ‹é‡ç»“æœä¹ŸåŒ…æ‹¬äº† Python ç¼–è¯‘å™¨å’Œæˆ‘ä»¬åŠ è½½çš„åº“æ‰€ä½¿ç”¨çš„å†…å­˜, æ‰€ä»¥å®é™…ä¸Šç”¨äºåŠ è½½æ•°æ®é›†çš„å†…å­˜ä¼šæ›´å°ä¸€äº›ã€‚ä¸ºäº†æ¯”è¾ƒ, è®©æˆ‘ä»¬ä½¿ç”¨ <code>dataset_size</code> å±æ€§çœ‹çœ‹æ•°æ®é›†åœ¨ç£ç›˜ä¸Šæœ‰å¤šå¤§ã€‚</font>ç”±äºç»“æœåƒä¹‹å‰ä¸€æ ·ç”¨å­—èŠ‚è¡¨ç¤º, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†å…¶è½¬æ¢ä¸ºGB:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Number of files in dataset : <span class="subst">&#123;pubmed_dataset.dataset_size&#125;</span>&quot;</span>)</span><br><span class="line">size_gb = pubmed_dataset.dataset_size / (<span class="number">1024</span>**<span class="number">3</span>) <span class="comment"># kb,mb,gbï¼Œæ•…ä¸º1024çš„ä¸‰æ¬¡æ–¹</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Dataset size (cache file) : <span class="subst">&#123;size_gb:<span class="number">.2</span>f&#125;</span> GB&quot;</span>)</span><br><span class="line"></span><br><span class="line">Number of files <span class="keyword">in</span> dataset : <span class="number">20979437051</span></span><br><span class="line">Dataset size (cache file) : <span class="number">19.54</span> GB</span><br></pre></td></tr></table></figure>
<p>éå¸¸æ£’ â€” å°½ç®¡å®ƒå°†è¿‘20GB, ä½†æˆ‘ä»¬èƒ½å¤Ÿå ç”¨å¾ˆå°‘çš„RAMç©ºé—´åŠ è½½å’Œè®¿é—®æ•°æ®é›†!</p>
<blockquote>
<p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> ä»<a target="_blank" rel="noopener" href="https://the-eye.eu/public/AI/pile_preliminary_components/">subsets</a>ä¸­é€‰æ‹©ä¸€ä¸ªå¤§äºä½ çš„ç¬”è®°æœ¬æˆ–è€…å°å¼æœºçš„RAMå¤§å°çš„å­é›†, ç”¨ ğŸ¤— DatasetsåŠ è½½è¿™ä¸ªæ•°æ®é›†, å¹¶ä¸”æµ‹é‡RAMçš„ä½¿ç”¨é‡ã€‚ è¯·æ³¨æ„, è¦è·å¾—å‡†ç¡®çš„æµ‹é‡ç»“æœ, ä½ éœ€è¦åœ¨å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚ä½ å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2101.00027">the Pile paper</a>çš„è¡¨ä¸€ä¸­æ‰¾åˆ°æ¯ä¸ªå­é›†è§£å‹åçš„å¤§å°ã€‚</p>
<p>å¦‚æœä½ ç†Ÿæ‚‰ Pandas, è¿™ä¸ªç»“æœå¯èƒ½ä¼šè®©äººæ„Ÿåˆ°å¾ˆæ„å¤–ã€‚å› ä¸º Wes Kinney çš„è‘—åçš„<a target="_blank" rel="noopener" href="https://wesmckinney.com/blog/apache-arrow-pandas-internals/">ç»éªŒæ³•åˆ™</a> æ˜¯ä½ éœ€è¦çš„RAMåº”è¯¥æ˜¯æ•°æ®é›†çš„å¤§å°çš„5å€åˆ°10å€ã€‚ é‚£ä¹ˆ ğŸ¤— Datasets æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªå†…å­˜ç®¡ç†é—®é¢˜çš„å‘¢? ğŸ¤— <font color="red">Datasets å°†æ¯ä¸€ä¸ªæ•°æ®é›†çœ‹ä½œä¸€ä¸ª<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Memory-mapped_file">å†…å­˜æ˜ å°„æ–‡ä»¶</a>, å®ƒæä¾›äº†RAMå’Œæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ä¹‹é—´çš„æ˜ å°„, è¯¥æ˜ å°„å…è®¸åº“è®¿é—®å’Œæ“ä½œæ•°æ®é›†çš„å…ƒç´ , è€Œä¸”æ— éœ€å°†å…¶å®Œå…¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</font></p>
</blockquote>
<p>å†…å­˜æ˜ å°„æ–‡ä»¶ä¹Ÿä¸€ä¸ªåœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´å…±äº«, è¿™ä½¿å¾—åƒ <code>Dataset.map()</code>ä¹‹ç±»çš„æ–¹æ³•å¯ä»¥å¹¶è¡ŒåŒ–, å¹¶ä¸”æ— éœ€ç§»åŠ¨æˆ–è€…èµ‹å€¼æ•°æ®é›†ã€‚åœ¨åº•å±‚, è¿™äº›åŠŸèƒ½éƒ½æ˜¯ç”±<a target="_blank" rel="noopener" href="https://arrow.apache.org/">Apache Arrow</a>å†…å­˜æ ¼å¼å’Œ<a target="_blank" rel="noopener" href="https://arrow.apache.org/docs/python/index.html"><code>pyarrow</code></a>åº“æä¾›çš„æ”¯æŒ, ä½¿å¾—æ•°æ®åŠ è½½å’Œå¤„ç†é€Ÿåº¦å¿«å¦‚é—ªç”µã€‚ (æ›´å¤šæœ‰å…³Apache Arrowçš„è¯¦ç»†ä¿¡æ¯ä»¥åŠä¸Pandasçš„æ¯”è¾ƒ, è¯·æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://towardsdatascience.com/apache-arrow-read-dataframe-with-zero-memory-69634092b1a">Dejan Simicâ€™s blog post</a>.) ä¸ºäº†æ›´æ¸…æ™°åœ°çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹, è®©æˆ‘ä»¬é€šè¿‡è¿­ä»£PubMed Abstractsæ•°æ®é›†ä¸­çš„æ‰€æœ‰å…ƒç´ æ¥è¿è¡Œä¸€ä¸ªé€Ÿåº¦æµ‹è¯•å°ç¨‹åº:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> timeit</span><br><span class="line"></span><br><span class="line">code_snippet = <span class="string">&quot;&quot;&quot;batch_size = 1000</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">for idx in range(0, len(pubmed_dataset), batch_size):</span></span><br><span class="line"><span class="string">    _ = pubmed_dataset[idx:idx + batch_size]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">time = timeit.timeit(stmt=code_snippet, number=<span class="number">1</span>, <span class="built_in">globals</span>=<span class="built_in">globals</span>())</span><br><span class="line"><span class="built_in">print</span>(</span><br><span class="line">    <span class="string">f&quot;Iterated over <span class="subst">&#123;<span class="built_in">len</span>(pubmed_dataset)&#125;</span> examples (about <span class="subst">&#123;size_gb:<span class="number">.1</span>f&#125;</span> GB) in &quot;</span></span><br><span class="line">    <span class="string">f&quot;<span class="subst">&#123;time:<span class="number">.1</span>f&#125;</span>s, i.e. <span class="subst">&#123;size_gb/time:<span class="number">.3</span>f&#125;</span> GB/s&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="string">&#x27;Iterated over 15518009 examples (about 19.5 GB) in 64.2s, i.e. 0.304 GB/s&#x27;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Pythonçš„ <code>timeit</code> æ¨¡å—æ¥æµ‹é‡æ‰§è¡Œ <code>code_snippet</code>æ‰€è€—çš„æ—¶é—´ã€‚ ä½ é€šå¸¸èƒ½ä»¥ååˆ†ä¹‹å‡ GB/såˆ°å‡ GB/sçš„é€Ÿåº¦è¿­ä»£æ•°æ®é›†ã€‚é€šè¿‡ä¸Šè¿°çš„æ–¹æ³•å°±å·²ç»èƒ½å¤Ÿè§£å†³å¤§å¤šæ•°å¤§æ•°æ®é›†åŠ è½½çš„é™åˆ¶, ä½†æ˜¯æœ‰æ—¶å€™ä½ ä¸å¾—ä¸ä½¿ç”¨ä¸€ä¸ªå¾ˆå¤§çš„æ•°æ®é›†, å®ƒç”šè‡³éƒ½ä¸èƒ½å­˜å‚¨åœ¨ç¬”è®°æœ¬ç”µè„‘çš„ç¡¬ç›˜ä¸Šã€‚ä¾‹å¦‚, å¦‚æœæˆ‘ä»¬å°è¯•ä¸‹è½½æ•´ä¸ª Pile, æˆ‘ä»¬éœ€è¦825GBçš„å¯ç”¨ç£ç›˜ç©ºé—´! ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µ, ğŸ¤— Datasets æä¾›äº†ä¸€ä¸ªæµå¼åŠŸèƒ½, è¿™ä¸ªåŠŸèƒ½å…è®¸æˆ‘ä»¬åŠ¨æ€ä¸‹è½½å’Œè®¿é—®å…ƒç´ , å¹¶ä¸”ä¸éœ€è¦ä¸‹è½½æ•´ä¸ªæ•°æ®é›†ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<h3 id="3æµæ•°æ®é›†"><a class="markdownIt-Anchor" href="#3æµæ•°æ®é›†"></a> 3.æµæ•°æ®é›†</h3>
<p>è¦ä½¿ç”¨æ•°æ®é›†æµ, ä½ åªéœ€è¦å°† <code>streaming=True</code> å‚æ•°ä¼ é€’ç»™ <code>load_dataset()</code> å‡½æ•°ã€‚æ¥ä¸‹æ¥, è®©æˆ‘ä»¬å†æ¬¡åŠ è½½ PubMed Abstracts æ•°æ®é›†, ä½†æ˜¯é‡‡ç”¨æµæ¨¡å¼:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pubmed_dataset_streamed = load_dataset(</span><br><span class="line">    <span class="string">&quot;json&quot;</span>, data_files=data_files, split=<span class="string">&quot;train&quot;</span>, streaming=<span class="literal">True</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><font color="red">ä¸æˆ‘ä»¬åœ¨æœ¬ç« å…¶ä»–åœ°æ–¹é‡åˆ°çš„ç†Ÿæ‚‰çš„ <code>Dataset</code> ä¸åŒ, <code>streaming=True</code> è¿”å›çš„å¯¹è±¡æ˜¯ä¸€ä¸ª <code>IterableDataset</code>ã€‚ é¡¾åæ€ä¹‰, è¦è®¿é—® <code>IterableDataset</code> , æˆ‘ä»¬éœ€è¦è¿­ä»£å®ƒã€‚</font>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è®¿é—®æµå¼æ•°æ®é›†çš„ç¬¬ä¸€ä¸ªå…ƒç´ :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(pubmed_dataset_streamed))</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409574</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Epidemiology of hypoxaemia in children with acute lower respiratory infection.\nTo determine the prevalence of hypoxaemia in children aged under 5 years suffering acute lower respiratory infections (ALRI), the risk factors for hypoxaemia in children under 5 years of age with ALRI, and the association of hypoxaemia with an increased risk of dying in children of the same age ...&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p><font size="5">IterableDataset.map()</font></p>
<p>å¦‚æœæ‚¨éœ€è¦åœ¨è®­ç»ƒæœŸé—´æ ‡è®°æµå¼æ•°æ®é›†ä¸­çš„å…ƒç´ å¯ä»¥ä½¿ç”¨ <code>IterableDataset.map()</code>è¿›è¡ŒåŠ¨æ€å¤„ç†ã€‚è¯¥è¿‡ç¨‹ä¸æˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter3">ç¬¬ä¸‰ç« </a>ä¸­æ ‡è®°æ•°æ®é›†çš„è¿‡ç¨‹å®Œå…¨ç›¸åŒ, å”¯ä¸€çš„åŒºåˆ«æ˜¯è¾“å‡ºæ˜¯é€ä¸ªè¿”å›çš„:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer</span><br><span class="line"></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">&quot;distilbert-base-uncased&quot;</span>)</span><br><span class="line">tokenized_dataset = pubmed_dataset_streamed.<span class="built_in">map</span>(<span class="keyword">lambda</span> x: tokenizer(x[<span class="string">&quot;text&quot;</span>]))</span><br><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(tokenized_dataset))</span><br><span class="line">&#123;<span class="string">&#x27;input_ids&#x27;</span>: [<span class="number">101</span>, <span class="number">4958</span>, <span class="number">5178</span>, <span class="number">4328</span>, <span class="number">6779</span>, ...], <span class="string">&#x27;attention_mask&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, ...]&#125;</span><br></pre></td></tr></table></figure>
<p><font size="5">IterableDataset.shuffle()</font></p>
<p>ğŸ’¡ ä½ å¯ä»¥ä¼ é€’ <code>batched=True</code> æ¥é€šè¿‡æµå¼åŠ é€Ÿæ ‡è®°åŒ–, å¦‚åŒæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚çœ‹åˆ°çš„é‚£æ ·ã€‚å®ƒå°†é€æ‰¹å¤„ç†ç¤ºä¾‹; é»˜è®¤çš„æ‰¹é‡å¤§å°ä¸º 1,000, å¯ä»¥ä½¿ç”¨ <code>batch_size</code> å‚æ•°æŒ‡å®šæ‰¹é‡å¤§å°ã€‚</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>IterableDataset.shuffle()</code> æ‰“ä¹±æµå¼æ•°æ®é›†, ä½†ä¸ <code>Dataset.shuffle()</code> ä¸åŒçš„æ˜¯è¿™åªä¼šæ‰“ä¹±é¢„å®šä¹‰ <code>buffer_size</code> ä¸­çš„å…ƒç´ :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">shuffled_dataset = pubmed_dataset_streamed.shuffle(buffer_size=<span class="number">10_000</span>, seed=<span class="number">42</span>)</span><br><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(shuffled_dataset))</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11410799</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Randomized study of dose or schedule modification of granulocyte colony-stimulating factor in platinum-based chemotherapy for elderly patients with lung cancer ...&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p><font size="5">IterableDataset.take() å’Œ IterableDataset.skip()</font></p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­, æˆ‘ä»¬ä»ç¼“å†²åŒºçš„å‰ 10,000 ä¸ªç¤ºä¾‹ä¸­éšæœºé€‰æ‹©äº†ä¸€ä¸ªç¤ºä¾‹ã€‚ä¸€æ—¦è®¿é—®äº†ä¸€ä¸ªç¤ºä¾‹, å®ƒåœ¨ç¼“å†²åŒºä¸­çš„ä½ç½®å°±ä¼šè¢«è¯­æ–™åº“ä¸­çš„ä¸‹ä¸€ä¸ªç¤ºä¾‹å¡«å…… (å³, ä¸Šè¿°æ¡ˆä¾‹ä¸­çš„ç¬¬ 10,001ä¸ªç¤ºä¾‹)ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>IterableDataset.take()</code> å’Œ <code>IterableDataset.skip()</code> å‡½æ•°ä»æµå¼æ•°æ®é›†ä¸­é€‰æ‹©å…ƒç´ , å®ƒçš„ä½œç”¨ç±»ä¼¼äº <code>Dataset.select()</code>ã€‚ä¾‹å¦‚, è¦é€‰æ‹© PubMed Abstracts æ•°æ®é›†çš„å‰5ä¸ªç¤ºä¾‹, æˆ‘ä»¬å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dataset_head = pubmed_dataset_streamed.take(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">list</span>(dataset_head)</span><br><span class="line">[&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409574</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Epidemiology of hypoxaemia in children with acute lower respiratory infection ...&#x27;</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409575</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Clinical signs of hypoxaemia in children with acute lower respiratory infection: indicators of oxygen therapy ...&#x27;</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409576</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&quot;Hypoxaemia in children with severe pneumonia in Papua New Guinea ...&quot;</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409577</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Oxygen concentrators and cylinders ...&#x27;</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409578</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Oxygen supply in rural africa: a personal experience ...&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>åŒæ ·, ä½ å¯ä»¥ä½¿ç”¨ <code>IterableDataset.skip()</code> å‡½æ•°å°†æ‰“ä¹±çš„æ•°æ®é›†æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’ŒéªŒè¯é›†, å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Skip the first 1,000 examples and include the rest in the training set</span></span><br><span class="line">train_dataset = shuffled_dataset.skip(<span class="number">1000</span>)</span><br><span class="line"><span class="comment"># Take the first 1,000 examples for the validation set</span></span><br><span class="line">validation_dataset = shuffled_dataset.take(<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>
<p><font size="5">interleave_datasets()</font></p>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡æ¥è¿›è¡Œæˆ‘ä»¬å¯¹æ•°æ®é›†æµçš„æœ€åæ¢ç´¢: å°†å¤šä¸ªæ•°æ®é›†ç»„åˆåœ¨ä¸€èµ·åˆ›å»ºä¸€ä¸ªå¿ƒå¾—è¯­æ–™åº“ã€‚ ğŸ¤— Datasets æä¾›äº†ä¸€ä¸ª <code>interleave_datasets()</code> å‡½æ•°, å®ƒå°†ä¸€ä¸ª <code>IterableDataset</code> å¯¹è±¡åˆ—è¡¨ç»„åˆä¸ºå•ä¸ªçš„ <code>IterableDataset</code>, å…¶ä¸­æ–°æ•°æ®é›†çš„å…ƒç´ æ˜¯é€šè¿‡åœ¨åˆ—è¡¨ä¸­çš„å¯¹è±¡äº¤æ›¿è·å¾—çš„<font color="red">(è½®æ¢å„é€‰ä¸€ä¸ªï¼‰</font>ã€‚å½“ä½ è¯•å›¾ç»„åˆå¤§å‹æ•°æ®é›†æ—¶, è¿™ä¸ªå‡½æ•°ç‰¹åˆ«æœ‰ç”¨, è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­æ¥è¯•ç€ç»„åˆ Pileçš„è‡ªç”±æ³•å¾‹æ•°æ®é›†,å®ƒæ˜¯æ¥è‡ªç¾å›½æ³•é™¢çš„51 GBçš„æ³•å¾‹æ„è§æ•°æ®é›†:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">law_dataset_streamed = load_dataset(</span><br><span class="line">    <span class="string">&quot;json&quot;</span>,</span><br><span class="line">    data_files=<span class="string">&quot;https://the-eye.eu/public/AI/pile_preliminary_components/FreeLaw_Opinions.jsonl.zst&quot;</span>,</span><br><span class="line">    split=<span class="string">&quot;train&quot;</span>,</span><br><span class="line">    streaming=<span class="literal">True</span>,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(law_dataset_streamed))</span><br><span class="line">&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;case_ID&#x27;</span>: <span class="string">&#x27;110921.json&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;case_jurisdiction&#x27;</span>: <span class="string">&#x27;scotus.tar.gz&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;date_created&#x27;</span>: <span class="string">&#x27;2010-04-28T17:12:49Z&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ•°æ®é›†è¶³å¤Ÿå¤§, å¯ä»¥å¯¹å¤§å¤šæ•°ç¬”è®°æœ¬ç”µè„‘çš„RAMæœ‰è¶³å¤Ÿçš„å‹åŠ›, ä½†æ˜¯æˆ‘ä»¬å·²ç»èƒ½å¤Ÿæ¯«ä¸è´¹åŠ›åœ°åŠ è½½å’Œè®¿é—®å®ƒ! ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ <code>interleave_datasets()</code> å‡½æ•°åŠ è½½æ¥è‡ª FreeLaw å’Œ PubMed Abstracts çš„æ•°æ®é›†:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> islice</span><br><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> interleave_datasets</span><br><span class="line"></span><br><span class="line">combined_dataset = interleave_datasets([pubmed_dataset_streamed, law_dataset_streamed])</span><br><span class="line"><span class="built_in">list</span>(islice(combined_dataset, <span class="number">2</span>))</span><br><span class="line">[&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pmid&#x27;</span>: <span class="number">11409574</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;eng&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;Epidemiology of hypoxaemia in children with acute lower respiratory infection ...&#x27;</span>&#125;,</span><br><span class="line"> &#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;case_ID&#x27;</span>: <span class="string">&#x27;110921.json&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;case_jurisdiction&#x27;</span>: <span class="string">&#x27;scotus.tar.gz&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;date_created&#x27;</span>: <span class="string">&#x27;2010-04-28T17:12:49Z&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;\n461 U.S. 238 (1983)\nOLIM ET AL.\nv.\nWAKINEKONA\nNo. 81-1581.\nSupreme Court of United States.\nArgued January 19, 1983.\nDecided April 26, 1983.\nCERTIORARI TO THE UNITED STATES COURT OF APPEALS FOR THE NINTH CIRCUIT\n*239 Michael A. Lilly, First Deputy Attorney General of Hawaii, argued the cause for petitioners. With him on the brief was James H. Dannenberg, Deputy Attorney General...&#x27;</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ªPythonçš„ <code>itertools</code> æ¨¡å—çš„ <code>islice()</code> å‡½æ•°ä»åˆå¹¶çš„æ•°æ®é›†ä¸­é€‰æ‹©å‰ä¸¤ä¸ªç¤ºä¾‹, å¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬å®é™…ä¸Šå°±æ˜¯ä¸¤ä¸ªæºæ•°æ®é›†ä¸­çš„å‰ä¸¤ä¸ªç¤ºä¾‹æ‹¼åœ¨ä¸€èµ·å½¢æˆçš„:</p>
<p><font size="5">ä¼ è¾“æ•´ä¸ªPile</font></p>
<p>æœ€å, å¦‚æœä½ æƒ³æµå¼ä¼ è¾“æ•´ä¸ª825GBçš„ Pile, ä½ å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è·å–æ‰€æœ‰å‡†å¤‡å¥½çš„æ–‡ä»¶:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">base_url = <span class="string">&quot;https://the-eye.eu/public/AI/pile/&quot;</span></span><br><span class="line">data_files = &#123;</span><br><span class="line">    <span class="string">&quot;train&quot;</span>: [base_url + <span class="string">&quot;train/&quot;</span> + <span class="string">f&quot;<span class="subst">&#123;idx:02d&#125;</span>.jsonl.zst&quot;</span> <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)],</span><br><span class="line">    <span class="string">&quot;validation&quot;</span>: base_url + <span class="string">&quot;val.jsonl.zst&quot;</span>,</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: base_url + <span class="string">&quot;test.jsonl.zst&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">pile_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=data_files, streaming=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">next</span>(<span class="built_in">iter</span>(pile_dataset[<span class="string">&quot;train&quot;</span>]))</span><br><span class="line">&#123;<span class="string">&#x27;meta&#x27;</span>: &#123;<span class="string">&#x27;pile_set_name&#x27;</span>: <span class="string">&#x27;Pile-CC&#x27;</span>&#125;,</span><br><span class="line"> <span class="string">&#x27;text&#x27;</span>: <span class="string">&#x27;It is done, and submitted. You can play â€œSurvival of the Tastiestâ€ on Android, and on the web...&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>âœï¸ <strong>è¯•è¯•çœ‹!</strong> ä½¿ç”¨åƒ<a target="_blank" rel="noopener" href="https://huggingface.co/datasets/mc4"><code>mc4</code></a> æˆ–è€… <a target="_blank" rel="noopener" href="https://huggingface.co/datasets/oscar"><code>oscar</code></a>è¿™æ ·çš„å¤§å‹ Common Crawl è¯­æ–™åº“æ¥åˆ›å»ºä¸€ä¸ªæµå¼å¤šè¯­è¨€æ•°æ®é›†, è¯¥æ•°æ®é›†ä»£è¡¨ä½ é€‰æ‹©çš„å›½å®¶/åœ°åŒºè¯­è¨€çš„å£è¯­æ¯”ä¾‹ã€‚ä¾‹å¦‚, ç‘å£«çš„å››ç§æ°‘æ—è¯­è¨€åˆ†åˆ«æ˜¯å¾·è¯­ã€æ³•è¯­ã€æ„å¤§åˆ©è¯­å’Œç½—æ›¼ä»€è¯­, å› æ­¤ä½ å¯ä»¥å°è¯•æ ¹æ®æ ¹æ®å£è¯­æ¯”ä¾‹å¯¹Oscarå­é›†è¿›è¡Œé‡‡ç”¨æ¥åˆ›å»ºç‘å£«è¯­æ–™åº“ã€‚</p>
<h2 id="åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†"><a class="markdownIt-Anchor" href="#åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†"></a> åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ª<a target="_blank" rel="noopener" href="https://github.com/features/issues/">GitHub issues</a>çš„è¯­æ–™åº“ï¼ŒGitHub issuesé€šå¸¸ç”¨äºè·Ÿè¸ª GitHub å­˜å‚¨åº“ä¸­çš„é”™è¯¯æˆ–åŠŸèƒ½ã€‚è¯¥è¯­æ–™åº“å¯ç”¨äºå„ç§ç›®çš„ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ¢ç´¢å…³é—­æœªè§£å†³çš„issueæˆ–æ‹‰å–è¯·æ±‚éœ€è¦å¤šé•¿æ—¶é—´</li>
<li>è®­ç»ƒä¸€ä¸ª<em>å¤šæ ‡ç­¾åˆ†ç±»å™¨</em>å¯ä»¥æ ¹æ®issueçš„æè¿°ï¼ˆä¾‹å¦‚ï¼Œâ€œé”™è¯¯â€ã€â€œå¢å¼ºâ€æˆ–â€œissueâ€ï¼‰ç”¨å…ƒæ•°æ®æ ‡è®°issue</li>
<li>åˆ›å»ºè¯­ä¹‰æœç´¢å¼•æ“ä»¥æŸ¥æ‰¾ä¸ç”¨æˆ·æŸ¥è¯¢åŒ¹é…çš„issue</li>
</ul>
<p><font color="red">GitHub issueå¯ä»¥ç†è§£ä¸ºè®¨è®ºåŒºä¸­çš„é—®é¢˜ä»¥åŠè§£ç­”</font></p>
<h3 id="1è·å–æ•°æ®é›†"><a class="markdownIt-Anchor" href="#1è·å–æ•°æ®é›†"></a> 1.è·å–æ•°æ®é›†</h3>
<p>æ‚¨å¯ä»¥æµè§ˆ ğŸ¤— Datasets ä¸­çš„æ‰€æœ‰issue<a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues">Issues tab</a>.å¦‚ä»¥ä¸‹å±å¹•æˆªå›¾æ‰€ç¤º</p>
<p><img src="datasets-issues.png" alt></p>
<p>ä¸€ä¸ªissueï¼Œå®ƒåŒ…å«ä¸€ä¸ªæ ‡é¢˜ã€ä¸€ä¸ªæè¿°å’Œä¸€ç»„è¡¨å¾è¯¥issueçš„æ ‡ç­¾ã€‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹.</p>
<p><img src="datasets-issues-single.png" alt></p>
<p>**æ–¹æ³•1ï¼š**è¦ä¸‹è½½æ‰€æœ‰å­˜å‚¨åº“çš„issueï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a target="_blank" rel="noopener" href="https://docs.github.com/en/rest">GitHub REST API</a>æŠ•ç¥¨<a target="_blank" rel="noopener" href="https://docs.github.com/en/rest/reference/issues#list-repository-issues">Issues endpoint</a>.æ­¤èŠ‚ç‚¹è¿”å›ä¸€ä¸ª JSON å¯¹è±¡åˆ—è¡¨ï¼Œæ¯ä¸ªå¯¹è±¡åŒ…å«å¤§é‡å­—æ®µï¼Œå…¶ä¸­åŒ…æ‹¬æ ‡é¢˜å’Œæè¿°ä»¥åŠæœ‰å…³issueçŠ¶æ€çš„å…ƒæ•°æ®ç­‰ã€‚</p>
<p>**æ–¹æ³•2ï¼š**ä¸‹è½½issueçš„ä¸€ç§ä¾¿æ·æ–¹å¼æ˜¯é€šè¿‡ <strong>requests</strong> åº“ï¼Œè¿™æ˜¯ç”¨ Python ä¸­å‘å‡º HTTP è¯·æ±‚çš„æ ‡å‡†æ–¹å¼ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹çš„ä»£ç æ¥å®‰è£…åº“ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip install requests</span><br></pre></td></tr></table></figure>
<p>å®‰è£…åº“åï¼Œæ‚¨é€šè¿‡è°ƒç”¨ <strong>requests.get()</strong> åŠŸèƒ½æ¥è·å–<strong>Issues</strong>èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥è·å–ç¬¬ä¸€é¡µä¸Šçš„ç¬¬ä¸€ä¸ªIssuesï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://api.github.com/repos/huggingface/datasets/issues?page=1&amp;per_page=1&quot;</span></span><br><span class="line">response = requests.get(url)</span><br></pre></td></tr></table></figure>
<p>è¿™ <strong>response</strong> å¯¹è±¡åŒ…å«å¾ˆå¤šå…³äºè¯·æ±‚çš„æœ‰ç”¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬ HTTP çŠ¶æ€ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.status_code</span><br><span class="line"></span><br><span class="line"><span class="number">200</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ä¸€ä¸ªçŠ¶æ€ç  <strong>200</strong> è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼ˆæ‚¨å¯ä»¥<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">åœ¨è¿™é‡Œ</a>æ‰¾åˆ°å¯èƒ½çš„ HTTP çŠ¶æ€ä»£ç åˆ—è¡¨ï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬çœŸæ­£æ„Ÿå…´è¶£çš„æ˜¯æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œç”±äºæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„issuesæ˜¯ JSON æ ¼å¼ï¼Œè®©æˆ‘ä»¬æŒ‰å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹æ‰€æœ‰çš„ä¿¡æ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">response.json()</span><br><span class="line">[&#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/2792&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;repository_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;labels_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/2792/labels&#123;/name&#125;&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;comments_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/2792/comments&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/2792/events&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/2792&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;id&#x27;</span>: <span class="number">968650274</span>,</span><br><span class="line">  <span class="string">&#x27;node_id&#x27;</span>: <span class="string">&#x27;MDExOlB1bGxSZXF1ZXN0NzEwNzUyMjc0&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;number&#x27;</span>: <span class="number">2792</span>,</span><br><span class="line">  <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;Update GooAQ&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;user&#x27;</span>: &#123;<span class="string">&#x27;login&#x27;</span>: <span class="string">&#x27;bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;id&#x27;</span>: <span class="number">19718818</span>,</span><br><span class="line">   <span class="string">&#x27;node_id&#x27;</span>: <span class="string">&#x27;MDQ6VXNlcjE5NzE4ODE4&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;avatar_url&#x27;</span>: <span class="string">&#x27;https://avatars.githubusercontent.com/u/19718818?v=4&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;gravatar_id&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;followers_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/followers&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;following_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/following&#123;/other_user&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;gists_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/gists&#123;/gist_id&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;starred_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/starred&#123;/owner&#125;&#123;/repo&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;subscriptions_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/subscriptions&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;organizations_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/orgs&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;repos_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/repos&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/events&#123;/privacy&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;received_events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/received_events&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;User&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;site_admin&#x27;</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;labels&#x27;</span>: [],</span><br><span class="line">  <span class="string">&#x27;state&#x27;</span>: <span class="string">&#x27;open&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;locked&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">  <span class="string">&#x27;assignee&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">  <span class="string">&#x27;assignees&#x27;</span>: [],</span><br><span class="line">  <span class="string">&#x27;milestone&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">  <span class="string">&#x27;comments&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&#x27;created_at&#x27;</span>: <span class="string">&#x27;2021-08-12T11:40:18Z&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;updated_at&#x27;</span>: <span class="string">&#x27;2021-08-12T12:31:17Z&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;closed_at&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">  <span class="string">&#x27;author_association&#x27;</span>: <span class="string">&#x27;CONTRIBUTOR&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;active_lock_reason&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line">  <span class="string">&#x27;pull_request&#x27;</span>: &#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/pulls/2792&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/2792&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;diff_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/2792.diff&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;patch_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/2792.patch&#x27;</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;body&#x27;</span>: <span class="string">&#x27;[GooAQ](https://github.com/allenai/gooaq) dataset was recently updated after splits were added for the same. This PR contains new updated GooAQ with train/val/test splits and updated README as well.&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;performed_via_github_app&#x27;</span>: <span class="literal">None</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>å“‡ï¼Œè¿™æ˜¯å¾ˆå¤šä¿¡æ¯ï¼æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ç”¨çš„å­—æ®µï¼Œä¾‹å¦‚ <strong>æ ‡é¢˜</strong> , <strong>å†…å®¹</strong> ï¼Œ <strong>å‚ä¸çš„æˆå‘˜</strong>ï¼Œ <strong>issueçš„æè¿°ä¿¡æ¯</strong>ï¼Œä»¥åŠæ‰“å¼€issueçš„GitHub ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p>
<blockquote>
<p>å¦‚ GitHub<a target="_blank" rel="noopener" href="https://docs.github.com/en/rest/overview/resources-in-the-rest-api#rate-limiting">æ–‡æ¡£</a> ä¸­æ‰€è¿°ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¯·æ±‚é™åˆ¶ä¸ºæ¯å°æ—¶ 60 ä¸ªè¯·æ±‚ã€‚è™½ç„¶ä½ å¯ä»¥å¢åŠ  <strong>per_page</strong> æŸ¥è¯¢å‚æ•°ä»¥å‡å°‘æ‚¨å‘å‡ºçš„è¯·æ±‚æ•°é‡ï¼Œæ‚¨ä»ç„¶ä¼šé­åˆ°ä»»ä½•è¶…è¿‡å‡ åƒä¸ªissueçš„å­˜å‚¨åº“çš„é€Ÿç‡é™åˆ¶ã€‚å› æ­¤ï¼Œæ‚¨åº”è¯¥å…³æ³¨ GitHub çš„<a target="_blank" rel="noopener" href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">åˆ›å»ºä¸ªäººèº«ä»½ä»¤ç‰Œ</a>ï¼Œåˆ›å»ºä¸€ä¸ªä¸ªäººè®¿é—®ä»¤ç‰Œè¿™æ ·æ‚¨å°±å¯ä»¥å°†é€Ÿç‡é™åˆ¶æé«˜åˆ°æ¯å°æ—¶ 5,000 ä¸ªè¯·æ±‚ã€‚è·å¾—ä»¤ç‰Œåï¼Œæ‚¨å¯ä»¥å°†å…¶åŒ…å«åœ¨è¯·æ±‚æ ‡å¤´ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GITHUB_TOKEN = xxx  <span class="comment"># Copy your GitHub token here</span></span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">f&quot;token <span class="subst">&#123;GITHUB_TOKEN&#125;</span>&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>âš ï¸ ä¸è¦ä¸é™Œç”Ÿäººå…±äº«å­˜åœ¨GITHUBä»¤ç‰Œçš„ç¬”è®°æœ¬ã€‚æˆ‘ä»¬å»ºè®®æ‚¨åœ¨ä½¿ç”¨å®Œåå°†GITHUBä»¤ç‰Œåˆ é™¤ï¼Œä»¥é¿å…æ„å¤–æ³„æ¼æ­¤ä¿¡æ¯ã€‚ä¸€ä¸ªæ›´å¥½çš„åšæ³•æ˜¯ï¼Œå°†ä»¤ç‰Œå­˜å‚¨åœ¨.envæ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/theskumar/python-dotenv"><code>python-dotenv</code> library</a> ä¸ºæ‚¨è‡ªåŠ¨å°†å…¶ä½œä¸ºç¯å¢ƒå˜é‡åŠ è½½ã€‚0</p>
</blockquote>
<p><font size="5">ä¸‹è½½æ‰€æœ‰issue</font></p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†è®¿é—®ä»¤ç‰Œï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯ä»¥ä» GitHub å­˜å‚¨åº“ä¸‹è½½æ‰€æœ‰issueçš„å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> tqdm.notebook <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fetch_issues</span>(<span class="params"></span></span><br><span class="line"><span class="params">    owner=<span class="string">&quot;huggingface&quot;</span>,</span></span><br><span class="line"><span class="params">    repo=<span class="string">&quot;datasets&quot;</span>,</span></span><br><span class="line"><span class="params">    num_issues=<span class="number">10_000</span>,</span></span><br><span class="line"><span class="params">    rate_limit=<span class="number">5_000</span>,</span></span><br><span class="line"><span class="params">    issues_path=Path(<span class="params"><span class="string">&quot;.&quot;</span></span>),</span></span><br><span class="line"><span class="params"></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> issues_path.is_dir():</span><br><span class="line">        issues_path.mkdir(exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    batch = []</span><br><span class="line">    all_issues = []</span><br><span class="line">    per_page = <span class="number">100</span>  <span class="comment"># Number of issues to return per page</span></span><br><span class="line">    num_pages = math.ceil(num_issues / per_page)</span><br><span class="line">    base_url = <span class="string">&quot;https://api.github.com/repos&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(num_pages)):</span><br><span class="line">        <span class="comment"># Query with state=all to get both open and closed issues</span></span><br><span class="line">        query = <span class="string">f&quot;issues?page=<span class="subst">&#123;page&#125;</span>&amp;per_page=<span class="subst">&#123;per_page&#125;</span>&amp;state=all&quot;</span></span><br><span class="line">        issues = requests.get(<span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>/<span class="subst">&#123;owner&#125;</span>/<span class="subst">&#123;repo&#125;</span>/<span class="subst">&#123;query&#125;</span>&quot;</span>, headers=headers)</span><br><span class="line">        batch.extend(issues.json())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(batch) &gt; rate_limit <span class="keyword">and</span> <span class="built_in">len</span>(all_issues) &lt; num_issues:</span><br><span class="line">            all_issues.extend(batch)</span><br><span class="line">            batch = []  <span class="comment"># Flush batch for next time period</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Reached GitHub rate limit. Sleeping for one hour ...&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">60</span> * <span class="number">60</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    all_issues.extend(batch)</span><br><span class="line">    df = pd.DataFrame.from_records(all_issues)</span><br><span class="line">    df.to_json(<span class="string">f&quot;<span class="subst">&#123;issues_path&#125;</span>/<span class="subst">&#123;repo&#125;</span>-issues.jsonl&quot;</span>, orient=<span class="string">&quot;records&quot;</span>, lines=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;Downloaded all the issues for <span class="subst">&#123;repo&#125;</span>! Dataset stored at <span class="subst">&#123;issues_path&#125;</span>/<span class="subst">&#123;repo&#125;</span>-issues.jsonl&quot;</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <strong>fetch_issues()</strong> æ‰¹é‡ä¸‹è½½æ‰€æœ‰issueï¼Œé¿å…è¶…è¿‡GitHubæ¯å°æ—¶çš„è¯·æ±‚æ•°é™åˆ¶ï¼›<font color="red">ç»“æœå°†å­˜å‚¨åœ¨repository_name-issues.jsonlæ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œä»£è¡¨ä¸€ä¸ªissueã€‚</font>è®©æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªå‡½æ•°ä» ğŸ¤— Datasetsä¸­æŠ“å–æ‰€æœ‰issueï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Depending on your internet connection, this can take several minutes to run...</span></span><br><span class="line">fetch_issues()</span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½issueåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ <a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter5/2">section 2</a>æ–°å­¦ä¼šçš„æ–¹æ³•åœ¨æœ¬åœ°åŠ è½½å®ƒä»¬:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">issues_dataset = load_dataset(<span class="string">&quot;json&quot;</span>, data_files=<span class="string">&quot;datasets-issues.jsonl&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">issues_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;repository_url&#x27;</span>, <span class="string">&#x27;labels_url&#x27;</span>, <span class="string">&#x27;comments_url&#x27;</span>, <span class="string">&#x27;events_url&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;node_id&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;labels&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;locked&#x27;</span>, <span class="string">&#x27;assignee&#x27;</span>, <span class="string">&#x27;assignees&#x27;</span>, <span class="string">&#x27;milestone&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;closed_at&#x27;</span>, <span class="string">&#x27;author_association&#x27;</span>, <span class="string">&#x27;active_lock_reason&#x27;</span>, <span class="string">&#x27;pull_request&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;timeline_url&#x27;</span>, <span class="string">&#x27;performed_via_github_app&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">3019</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬å·²ç»ä»å¤´å¼€å§‹åˆ›å»ºäº†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•°æ®é›†ï¼ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰å‡ åƒä¸ªissueï¼Œè€ŒğŸ¤— Datasetså­˜å‚¨åº“ä¸­çš„<a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues">Issues é€‰é¡¹å¡</a>æ€»å…±å´åªæ˜¾ç¤ºäº†å¤§çº¦ 1,000 ä¸ªissueğŸ¤”ï¼Ÿå¦‚ GitHub <a target="_blank" rel="noopener" href="https://docs.github.com/en/rest/reference/issues#list-issues-assigned-to-the-authenticated-user">æ–‡æ¡£</a>ä¸­æ‰€è¿°ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬ä¹Ÿä¸‹è½½äº†æ‰€æœ‰çš„æ‹‰å–è¯·æ±‚ï¼š</p>
<blockquote>
<p>Git Hubçš„REST API v3è®¤ä¸ºæ¯ä¸ªpullè¯·æ±‚éƒ½æ˜¯ä¸€ä¸ªissueï¼Œä½†å¹¶ä¸æ˜¯æ¯ä¸ªissueéƒ½æ˜¯ä¸€ä¸ªpullè¯·æ±‚ã€‚å› æ­¤ï¼Œâ€œIssuesâ€èŠ‚ç‚¹å¯èƒ½åœ¨å“åº”ä¸­åŒæ—¶è¿”å›issueå’Œæ‹‰å–è¯·æ±‚ã€‚ä½ å¯ä»¥é€šè¿‡pull_request çš„ keyæ¥è¾¨åˆ«pullè¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œä»â€œIssuesâ€èŠ‚ç‚¹è¿”å›çš„pullè¯·æ±‚çš„idå°†æ˜¯ä¸€ä¸ªissue idã€‚</p>
</blockquote>
<p>ç”±äºissueå’Œpull requestçš„å†…å®¹æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæˆ‘ä»¬å…ˆåšä¸€äº›å°çš„é¢„å¤„ç†ï¼Œè®©æˆ‘ä»¬èƒ½å¤ŸåŒºåˆ†å®ƒä»¬ã€‚</p>
<h3 id="2æ¸…æ´—æ•°æ®é›†"><a class="markdownIt-Anchor" href="#2æ¸…æ´—æ•°æ®é›†"></a> 2.æ¸…æ´—æ•°æ®é›†</h3>
<p><strong>pull_request</strong> åˆ—å¯ç”¨äºåŒºåˆ†issueå’Œæ‹‰å–è¯·æ±‚ã€‚è®©æˆ‘ä»¬éšæœºæŒ‘é€‰ä¸€äº›æ ·æœ¬ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆä¸åŒã€‚æˆ‘ä»¬å°†ä½¿ç”¨åœ¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter5/3">ç¬¬ä¸‰èŠ‚</a>, å­¦ä¹ çš„æ–¹æ³•ï¼Œä½¿ç”¨ <strong>Dataset.shuffle()</strong> å’Œ <strong>Dataset.select()</strong> æŠ½å–ä¸€ä¸ªéšæœºæ ·æœ¬ï¼Œç„¶åå°† <strong>html_url</strong> å’Œ <strong>pull_request</strong> åˆ—ä½¿ç”¨zipå‡½æ•°æ‰“åŒ…ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ¯”è¾ƒå„ç§ URLï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sample = issues_dataset.shuffle(seed=<span class="number">666</span>).select(<span class="built_in">range</span>(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print out the URL and pull request entries</span></span><br><span class="line"><span class="keyword">for</span> url, pr <span class="keyword">in</span> <span class="built_in">zip</span>(sample[<span class="string">&quot;html_url&quot;</span>], sample[<span class="string">&quot;pull_request&quot;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&gt;&gt; URL: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;&gt;&gt; Pull request: <span class="subst">&#123;pr&#125;</span>\n&quot;</span>)</span><br><span class="line">&gt;&gt; URL: https://github.com/huggingface/datasets/pull/<span class="number">850</span></span><br><span class="line">&gt;&gt; Pull request: &#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/pulls/850&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/850&#x27;</span>, <span class="string">&#x27;diff_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/850.diff&#x27;</span>, <span class="string">&#x27;patch_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/850.patch&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt; URL: https://github.com/huggingface/datasets/issues/<span class="number">2773</span></span><br><span class="line">&gt;&gt; Pull request: <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">&gt;&gt; URL: https://github.com/huggingface/datasets/pull/<span class="number">783</span></span><br><span class="line">&gt;&gt; Pull request: &#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/pulls/783&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/783&#x27;</span>, <span class="string">&#x27;diff_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/783.diff&#x27;</span>, <span class="string">&#x27;patch_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/783.patch&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªpullè¯·æ±‚éƒ½ä¸å„ç§urlç›¸å…³è”ï¼Œè€Œæ™®é€šissueåªæœ‰ä¸€ä¸ªNoneæ¡ç›®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸€ç‚¹ä¸åŒæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„is_pull_requeståˆ—é€šè¿‡æ£€æŸ¥pull_requestå­—æ®µæ˜¯å¦ä¸ºNoneæ¥åŒºåˆ†å®ƒä»¬:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">issues_dataset = issues_dataset.<span class="built_in">map</span>(</span><br><span class="line">    <span class="keyword">lambda</span> x: &#123;<span class="string">&quot;is_pull_request&quot;</span>: <span class="literal">False</span> <span class="keyword">if</span> x[<span class="string">&quot;pull_request&quot;</span>] <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="literal">True</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><font color="red">å°½ç®¡æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤æˆ–é‡å‘½åæŸäº›åˆ—æ¥è¿›ä¸€æ­¥æ¸…ç†æ•°æ®é›†ï¼Œä½†åœ¨æ­¤é˜¶æ®µå°½å¯èƒ½ä¿æŒæ•°æ®é›†â€œåŸå§‹â€çŠ¶æ€é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¸­è½»æ¾ä½¿ç”¨ã€‚</font>åœ¨æˆ‘ä»¬å°†æ•°æ®é›†æ¨é€åˆ° Hugging Face Hub ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å†æ·»åŠ ä¸€äº›ç¼ºå°‘çš„æ•°æ®ï¼šä¸æ¯ä¸ªissueå’Œæ‹‰å–è¯·æ±‚ç›¸å…³çš„è¯„è®ºã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°†æ·»åŠ å®ƒä»¬â€”â€”ä½ çŒœå¯¹äº†â€”â€”æˆ‘ä»¬å°†ä¾ç„¶ä½¿ç”¨GitHub REST APIï¼</p>
<h3 id="3æ‰©å……æ•°æ®é›†"><a class="markdownIt-Anchor" href="#3æ‰©å……æ•°æ®é›†"></a> 3.æ‰©å……æ•°æ®é›†</h3>
<p><font size="5"> æ‹‰å–è¯„è®º</font></p>
<p>GitHub REST API æä¾›äº†ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://docs.github.com/en/rest/reference/issues#list-issue-comments">è¯„è®ºèŠ‚ç‚¹</a> è¿”å›ä¸issueç¼–å·ç›¸å…³çš„æ‰€æœ‰è¯„è®ºã€‚è®©æˆ‘ä»¬æµ‹è¯•èŠ‚ç‚¹ä»¥æŸ¥çœ‹å®ƒè¿”å›çš„å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">issue_number = <span class="number">2792</span></span><br><span class="line">url = <span class="string">f&quot;https://api.github.com/repos/huggingface/datasets/issues/<span class="subst">&#123;issue_number&#125;</span>/comments&quot;</span></span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line">response.json()</span><br><span class="line">[&#123;<span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/comments/897594128&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/huggingface/datasets/pull/2792#issuecomment-897594128&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;issue_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/repos/huggingface/datasets/issues/2792&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;id&#x27;</span>: <span class="number">897594128</span>,</span><br><span class="line">  <span class="string">&#x27;node_id&#x27;</span>: <span class="string">&#x27;IC_kwDODunzps41gDMQ&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;user&#x27;</span>: &#123;<span class="string">&#x27;login&#x27;</span>: <span class="string">&#x27;bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;id&#x27;</span>: <span class="number">19718818</span>,</span><br><span class="line">   <span class="string">&#x27;node_id&#x27;</span>: <span class="string">&#x27;MDQ6VXNlcjE5NzE4ODE4&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;avatar_url&#x27;</span>: <span class="string">&#x27;https://avatars.githubusercontent.com/u/19718818?v=4&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;gravatar_id&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;html_url&#x27;</span>: <span class="string">&#x27;https://github.com/bhavitvyamalik&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;followers_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/followers&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;following_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/following&#123;/other_user&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;gists_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/gists&#123;/gist_id&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;starred_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/starred&#123;/owner&#125;&#123;/repo&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;subscriptions_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/subscriptions&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;organizations_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/orgs&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;repos_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/repos&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/events&#123;/privacy&#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;received_events_url&#x27;</span>: <span class="string">&#x27;https://api.github.com/users/bhavitvyamalik/received_events&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;User&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;site_admin&#x27;</span>: <span class="literal">False</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;created_at&#x27;</span>: <span class="string">&#x27;2021-08-12T12:21:52Z&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;updated_at&#x27;</span>: <span class="string">&#x27;2021-08-12T12:31:17Z&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;author_association&#x27;</span>: <span class="string">&#x27;CONTRIBUTOR&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;body&#x27;</span>: <span class="string">&quot;@albertvillanova my tests are failing here:\r\n```\r\ndataset_name = &#x27;gooaq&#x27;\r\n\r\n    def test_load_dataset(self, dataset_name):\r\n        configs = self.dataset_tester.load_all_configs(dataset_name, is_local=True)[:1]\r\n&gt;       self.dataset_tester.check_load_dataset(dataset_name, configs, is_local=True, use_local_dummy_data=True)\r\n\r\ntests/test_dataset_common.py:234: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\ntests/test_dataset_common.py:187: in check_load_dataset\r\n    self.parent.assertTrue(len(dataset[split]) &gt; 0)\r\nE   AssertionError: False is not true\r\n```\r\nWhen I try loading dataset on local machine it works fine. Any suggestions on how can I avoid this error?&quot;</span>,</span><br><span class="line">  <span class="string">&#x27;performed_via_github_app&#x27;</span>: <span class="literal">None</span>&#125;]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ³¨é‡Šå­˜å‚¨åœ¨bodyå­—æ®µä¸­ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œé€šè¿‡åœ¨response.json()ä¸­ä¸ºæ¯ä¸ªå…ƒç´ æŒ‘é€‰bodyå†…å®¹æ¥è¿”å›ä¸æŸä¸ªissueç›¸å…³çš„æ‰€æœ‰è¯„è®ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_comments</span>(<span class="params">issue_number</span>):</span><br><span class="line">    url = <span class="string">f&quot;https://api.github.com/repos/huggingface/datasets/issues/<span class="subst">&#123;issue_number&#125;</span>/comments&quot;</span></span><br><span class="line">    response = requests.get(url, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> [r[<span class="string">&quot;body&quot;</span>] <span class="keyword">for</span> r <span class="keyword">in</span> response.json()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test our function works as expected</span></span><br><span class="line">get_comments(<span class="number">2792</span>)</span><br><span class="line">[<span class="string">&quot;@albertvillanova my tests are failing here:\r\n```\r\ndataset_name = &#x27;gooaq&#x27;\r\n\r\n    def test_load_dataset(self, dataset_name):\r\n        configs = self.dataset_tester.load_all_configs(dataset_name, is_local=True)[:1]\r\n&gt;       self.dataset_tester.check_load_dataset(dataset_name, configs, is_local=True, use_local_dummy_data=True)\r\n\r\ntests/test_dataset_common.py:234: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\ntests/test_dataset_common.py:187: in check_load_dataset\r\n    self.parent.assertTrue(len(dataset[split]) &gt; 0)\r\nE   AssertionError: False is not true\r\n```\r\nWhen I try loading dataset on local machine it works fine. Any suggestions on how can I avoid this error?&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>è¿™çœ‹èµ·æ¥ä¸é”™ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ <strong>Dataset.map()</strong> æ–¹æ³•åœ¨æˆ‘ä»¬æ•°æ®é›†ä¸­æ¯ä¸ªissueçš„æ·»åŠ ä¸€ä¸ª<strong>comments</strong>åˆ—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Depending on your internet connection, this can take a few minutes...</span></span><br><span class="line">issues_with_comments_dataset = issues_dataset.<span class="built_in">map</span>(</span><br><span class="line">    <span class="keyword">lambda</span> x: &#123;<span class="string">&quot;comments&quot;</span>: get_comments(x[<span class="string">&quot;number&quot;</span>])&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="4ä¸Šä¼ æ•°æ®é›†"><a class="markdownIt-Anchor" href="#4ä¸Šä¼ æ•°æ®é›†"></a> 4.ä¸Šä¼ æ•°æ®é›†</h3>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†å¢å¼ºçš„æ•°æ®é›†ï¼Œæ˜¯æ—¶å€™å°†å®ƒæ¨é€åˆ° Hub ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä¸ç¤¾åŒºå…±äº«å®ƒäº†ï¼ ä¸Šä¼ æ•°æ®é›†éå¸¸ç®€å•ï¼šå°±åƒ ğŸ¤— Transformers ä¸­çš„æ¨¡å‹å’Œåˆ†è¯å™¨ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>push_to_hub()</code> æ–¹æ³•æ¥æ¨é€æ•°æ®é›†ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèº«ä»½éªŒè¯ä»¤ç‰Œï¼Œå®ƒå¯ä»¥é€šè¿‡é¦–å…ˆä½¿ç”¨ <code>notebook_login()</code> å‡½æ•°ç™»å½•åˆ° Hugging Face Hub æ¥è·å¾—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> huggingface_hub <span class="keyword">import</span> notebook_login</span><br><span class="line"></span><br><span class="line">notebook_login()</span><br></pre></td></tr></table></figure>
<p>è¿™å°†åˆ›å»ºä¸€ä¸ªå°éƒ¨ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¾“å…¥æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œ API ä»¤ç‰Œå°†ä¿å­˜åœ¨~/.huggingface/ä»¤ç‰Œ.å¦‚æœæ‚¨åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»£ç ï¼Œåˆ™å¯ä»¥æ”¹ä¸ºé€šè¿‡ CLI ç™»å½•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">huggingface-cli login</span><br></pre></td></tr></table></figure>
<p>å®Œæˆæ­¤æ“ä½œåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä¸‹é¢çš„ä»£ç ä¸Šä¼ æˆ‘ä»¬çš„æ•°æ®é›†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">issues_with_comments_dataset.push_to_hub(<span class="string">&quot;github-issues&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡ä¾¿æ·åœ°æä¾›å¸¦æœ‰å­˜å‚¨åº“ ID ä½œä¸º path å‚æ•°çš„ load_dataset() æ¥ä¸‹è½½æ•°æ®é›†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">remote_dataset = load_dataset(<span class="string">&quot;lewtun/github-issues&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line">remote_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;repository_url&#x27;</span>, <span class="string">&#x27;labels_url&#x27;</span>, <span class="string">&#x27;comments_url&#x27;</span>, <span class="string">&#x27;events_url&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;node_id&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;labels&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;locked&#x27;</span>, <span class="string">&#x27;assignee&#x27;</span>, <span class="string">&#x27;assignees&#x27;</span>, <span class="string">&#x27;milestone&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;closed_at&#x27;</span>, <span class="string">&#x27;author_association&#x27;</span>, <span class="string">&#x27;active_lock_reason&#x27;</span>, <span class="string">&#x27;pull_request&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;performed_via_github_app&#x27;</span>, <span class="string">&#x27;is_pull_request&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">2855</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº› Git é­”æ³•ç›´æ¥ä»ç»ˆç«¯å°†æ•°æ®é›†ä¸Šä¼ åˆ° Hugging Face Hubã€‚æœ‰å…³å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://huggingface.co/docs/datasets/share#share-a-dataset-using-the-cli">ğŸ¤— Datasets guide</a> æŒ‡å—ã€‚</p>
</blockquote>
<h3 id="5åˆ›å»ºæ•°æ®é›†å¡ç‰‡"><a class="markdownIt-Anchor" href="#5åˆ›å»ºæ•°æ®é›†å¡ç‰‡"></a> 5.åˆ›å»ºæ•°æ®é›†å¡ç‰‡</h3>
<p><a target="_blank" rel="noopener" href="https://huggingface.co/learn/nlp-course/zh-CN/chapter5/5?fw=pt#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86%E5%8D%A1%E7%89%87">åˆ›å»ºè‡ªå·±çš„æ•°æ®é›† (huggingface.co)</a></p>
<h2 id="ä½¿ç”¨-faiss-è¿›è¡Œè¯­ä¹‰æœç´¢"><a class="markdownIt-Anchor" href="#ä½¿ç”¨-faiss-è¿›è¡Œè¯­ä¹‰æœç´¢"></a> ä½¿ç”¨ FAISS è¿›è¡Œè¯­ä¹‰æœç´¢</h2>
<h3 id="1ä½¿ç”¨embeddingè¿›è¡Œè¯­ä¹‰æœç´¢"><a class="markdownIt-Anchor" href="#1ä½¿ç”¨embeddingè¿›è¡Œè¯­ä¹‰æœç´¢"></a> 1.ä½¿ç”¨embeddingè¿›è¡Œè¯­ä¹‰æœç´¢</h3>
<p>åŸºäº Transformer çš„è¯­è¨€æ¨¡å‹ä¼šå°†æ–‡æœ¬ä¸­çš„æ¯ä¸ªæ ‡è®°è½¬æ¢ä¸ºåµŒå…¥å‘é‡.<font color="red">äº‹å®è¯æ˜ï¼Œå¯ä»¥â€œæ±‡é›†â€å„ä¸ªåµŒå…¥å‘é‡æ¥åˆ›å»ºæ•´ä¸ªå¥å­ã€æ®µè½æˆ–æ–‡æ¡£ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼‰çš„å‘é‡è¡¨ç¤ºã€‚ç„¶åï¼Œé€šè¿‡è®¡ç®—æ¯ä¸ªåµŒå…¥ä¹‹é—´çš„ç‚¹ç§¯ç›¸ä¼¼åº¦ï¼ˆæˆ–å…¶ä»–ä¸€äº›ç›¸ä¼¼åº¦åº¦é‡ï¼‰å¹¶è¿”å›ç›¸ä¼¼åº¦æœ€å¤§çš„æ–‡æ¡£ï¼Œè¿™äº›åµŒå…¥å¯ç”¨äºåœ¨è¯­æ–™åº“ä¸­æ‰¾åˆ°ç›¸ä¼¼çš„æ–‡æ¡£ã€‚</font>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åµŒå…¥æ¥å¼€å‘è¯­ä¹‰æœç´¢å¼•æ“ã€‚ä¸åŸºäºå°†æŸ¥è¯¢ä¸­çš„å…³é”®å­—çš„ä¼ ç»Ÿæ–¹æ³•ç›¸æ¯”ï¼Œè¿™äº›æœç´¢å¼•æ“å…·æœ‰å¤šç§ä¼˜åŠ¿ã€‚</p>
<h3 id="2åŠ è½½å’Œå‡†å¤‡æ•°æ®é›†"><a class="markdownIt-Anchor" href="#2åŠ è½½å’Œå‡†å¤‡æ•°æ®é›†"></a> 2.åŠ è½½å’Œå‡†å¤‡æ•°æ®é›†</h3>
<p>æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸‹è½½æˆ‘ä»¬çš„ GitHub issues æ•°æ®é›†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åƒå¾€å¸¸é‚£æ ·ä½¿ç”¨ <code>load_dataset()</code>å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> load_dataset</span><br><span class="line"></span><br><span class="line">issues_dataset = load_dataset(<span class="string">&quot;lewtun/github-issues&quot;</span>, split=<span class="string">&quot;train&quot;</span>)</span><br><span class="line"></span><br><span class="line">issues_dataset</span><br><span class="line"></span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;repository_url&#x27;</span>, <span class="string">&#x27;labels_url&#x27;</span>, <span class="string">&#x27;comments_url&#x27;</span>, <span class="string">&#x27;events_url&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;node_id&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;labels&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;locked&#x27;</span>, <span class="string">&#x27;assignee&#x27;</span>, <span class="string">&#x27;assignees&#x27;</span>, <span class="string">&#x27;milestone&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;closed_at&#x27;</span>, <span class="string">&#x27;author_association&#x27;</span>, <span class="string">&#x27;active_lock_reason&#x27;</span>, <span class="string">&#x27;pull_request&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;performed_via_github_app&#x27;</span>, <span class="string">&#x27;is_pull_request&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">2855</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨load_dataset()ä¸­ä½¿ç”¨äº†é»˜è®¤çš„è®­ç»ƒé›†åˆ†å‰²ï¼Œæ‰€ä»¥å®ƒè¿”å›ä¸€ä¸ªæ•°æ®é›†è€Œä¸æ˜¯æ•°æ®é›†å­—å…¸ã€‚</p>
<p><font size="5">è¿‡æ»¤æ‰pullè¯·æ±‚</font></p>
<p><font color="red">ç¬¬ä¸€é¡¹ä»»åŠ¡æ˜¯è¿‡æ»¤æ‰pullè¯·æ±‚ï¼Œå› ä¸ºè¿™äº›è¯·æ±‚å¾ˆå°‘ç”¨äºå›ç­”ç”¨æˆ·æå‡ºçš„é—®é¢˜ï¼Œè€Œä¸”ä¼šç»™æˆ‘ä»¬çš„æœç´¢å¼•æ“å¸¦æ¥å™ªå£°ã€‚</font>ç°åœ¨åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>dataset.filter()</code>å‡½æ•°æ¥æ’é™¤æ•°æ®é›†ä¸­çš„è¿™äº›è¡Œã€‚åŒæ—¶ï¼Œè®©æˆ‘ä»¬ä¹Ÿè¿‡æ»¤æ‰æ²¡æœ‰æ³¨é‡Šçš„è¡Œï¼Œå› ä¸ºè¿™äº›è¡Œä¸ä¼šæ˜¯ç”¨æˆ·æé—®çš„ç­”æ¡ˆ:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">issues_dataset = issues_dataset.<span class="built_in">filter</span>(</span><br><span class="line">    <span class="keyword">lambda</span> x: (x[<span class="string">&quot;is_pull_request&quot;</span>] == <span class="literal">False</span> <span class="keyword">and</span> <span class="built_in">len</span>(x[<span class="string">&quot;comments&quot;</span>]) &gt; <span class="number">0</span>)</span><br><span class="line">)</span><br><span class="line">issues_dataset</span><br><span class="line"></span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;repository_url&#x27;</span>, <span class="string">&#x27;labels_url&#x27;</span>, <span class="string">&#x27;comments_url&#x27;</span>, <span class="string">&#x27;events_url&#x27;</span>, <span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;node_id&#x27;</span>, <span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;labels&#x27;</span>, <span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;locked&#x27;</span>, <span class="string">&#x27;assignee&#x27;</span>, <span class="string">&#x27;assignees&#x27;</span>, <span class="string">&#x27;milestone&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;closed_at&#x27;</span>, <span class="string">&#x27;author_association&#x27;</span>, <span class="string">&#x27;active_lock_reason&#x27;</span>, <span class="string">&#x27;pull_request&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;performed_via_github_app&#x27;</span>, <span class="string">&#x27;is_pull_request&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">771</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><font size="5">åˆ é™¤å…¶ä½™éƒ¨åˆ†</font></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ•°æ®é›†ä¸­æœ‰å¾ˆå¤šåˆ—ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æˆ‘ä»¬ä¸éœ€è¦æ„å»ºæˆ‘ä»¬çš„æœç´¢å¼•æ“ã€‚ä»æœç´¢çš„è§’åº¦æ¥çœ‹ï¼Œä¿¡æ¯é‡æœ€å¤§çš„åˆ—æ˜¯ <strong>title</strong> , <strong>body</strong> ï¼Œ å’Œ <strong>comments</strong> ï¼Œè€Œ <strong>html_url</strong> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå›åˆ°æºé—®é¢˜çš„é“¾æ¥ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ <strong>Dataset.remove_columns()</strong> åˆ é™¤å…¶ä½™éƒ¨åˆ†çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">columns = issues_dataset.column_names</span><br><span class="line">columns_to_keep = [<span class="string">&quot;title&quot;</span>, <span class="string">&quot;body&quot;</span>, <span class="string">&quot;html_url&quot;</span>, <span class="string">&quot;comments&quot;</span>]</span><br><span class="line">columns_to_remove = <span class="built_in">set</span>(columns_to_keep).symmetric_difference(columns)</span><br><span class="line">issues_dataset = issues_dataset.remove_columns(columns_to_remove)</span><br><span class="line">issues_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;body&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">771</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><font size="5">ç”¨é—®é¢˜çš„æ ‡é¢˜å’Œæ­£æ–‡æ¥æ‰©å……æ¯æ¡è¯„è®º</font></p>
<p>ä¸ºäº†åˆ›å»ºæˆ‘ä»¬çš„åµŒå…¥ï¼Œæˆ‘ä»¬å°†ç”¨é—®é¢˜çš„æ ‡é¢˜å’Œæ­£æ–‡æ¥æ‰©å……æ¯æ¡è¯„è®ºï¼Œå› ä¸ºè¿™äº›å­—æ®µé€šå¸¸åŒ…å«æœ‰ç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å› ä¸ºæˆ‘ä»¬çš„ <strong>comments</strong> åˆ—å½“å‰æ˜¯æ¯ä¸ªé—®é¢˜çš„è¯„è®ºåˆ—è¡¨ï¼Œæˆ‘ä»¬éœ€è¦â€œé‡æ–°ç»„åˆâ€åˆ—ï¼Œä»¥ä¾¿æ¯ä¸€æ¡è¯„è®ºéƒ½åŒ…å«ä¸€ä¸ª <strong>(html_url, title, body, comment)</strong> å…ƒç»„ã€‚åœ¨ Pandas ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.explode.html">DataFrame.explode() å‡½æ•°</a>, å®ƒä¸ºç±»ä¼¼åˆ—è¡¨çš„åˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°è¡Œï¼ŒåŒæ—¶å¤åˆ¶æ‰€æœ‰å…¶ä»–åˆ—å€¼ã€‚ä¸ºäº†çœ‹åˆ°å®ƒçš„å®é™…æ•ˆæœï¼Œè®©æˆ‘ä»¬é¦–å…ˆåˆ‡æ¢åˆ° Pandasçš„<strong>DataFrame</strong> æ ¼å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">issues_dataset.set_format(<span class="string">&quot;pandas&quot;</span>)</span><br><span class="line">df = issues_dataset[:]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬æ£€æŸ¥è¿™é‡Œçš„ç¬¬ä¸€è¡Œ <strong>DataFrame</strong> æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªè¯„è®ºä¸è¿™ä¸ªé—®é¢˜ç›¸å…³ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&quot;comments&quot;</span>][<span class="number">0</span>].tolist()</span><br><span class="line">[<span class="string">&#x27;the bug code locate in ï¼š\r\n    if data_args.task_name is not None:\r\n        # Downloading and loading a dataset from the hub.\r\n        datasets = load_dataset(&quot;glue&quot;, data_args.task_name, cache_dir=model_args.cache_dir)&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;Hi @jinec,\r\n\r\nFrom time to time we get this kind of `ConnectionError` coming from the github.com website: https://raw.githubusercontent.com\r\n\r\nNormally, it should work if you wait a little and then retry.\r\n\r\nCould you please confirm if the problem persists?&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;cannot connectï¼Œeven by Web browserï¼Œplease check that  there is some  problemsã€‚&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;I can access https://raw.githubusercontent.com/huggingface/datasets/1.7.0/datasets/glue/glue.py without problem...&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¸Œæœ›è¿™äº›è¯„è®ºä¸­çš„æ¯ä¸€æ¡éƒ½å¾—åˆ°ä¸€è¡Œã€‚è®©æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ˜¯è¿™ç§æƒ…å†µï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">comments_df = df.explode(<span class="string">&quot;comments&quot;</span>, ignore_index=<span class="literal">True</span>)</span><br><span class="line">comments_df.head(<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th></th>
<th>html_url</th>
<th>title</th>
<th>comments</th>
<th>body</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td><a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues/2787">https://github.com/huggingface/datasets/issues/2787</a></td>
<td>ConnectionError: Couldnâ€™t reach <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a></td>
<td>the bug code locate in ï¼š\r\n if data_args.task_name is not Noneâ€¦</td>
<td>Hello,\r\nI am trying to run run_glue.py and it gives me this errorâ€¦</td>
</tr>
<tr>
<td>1</td>
<td><a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues/2787">https://github.com/huggingface/datasets/issues/2787</a></td>
<td>ConnectionError: Couldnâ€™t reach <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a></td>
<td>Hi @jinec,\r\n\r\nFrom time to time we get this kind of <code>ConnectionError</code> coming from the <a target="_blank" rel="noopener" href="http://github.com">github.com</a> website: <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a>â€¦</td>
<td>Hello,\r\nI am trying to run run_glue.py and it gives me this errorâ€¦</td>
</tr>
<tr>
<td>2</td>
<td><a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues/2787">https://github.com/huggingface/datasets/issues/2787</a></td>
<td>ConnectionError: Couldnâ€™t reach <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a></td>
<td>cannot connectï¼Œeven by Web browserï¼Œplease check that there is some problemsã€‚</td>
<td>Hello,\r\nI am trying to run run_glue.py and it gives me this errorâ€¦</td>
</tr>
<tr>
<td>3</td>
<td><a target="_blank" rel="noopener" href="https://github.com/huggingface/datasets/issues/2787">https://github.com/huggingface/datasets/issues/2787</a></td>
<td>ConnectionError: Couldnâ€™t reach <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com">https://raw.githubusercontent.com</a></td>
<td>I can access <a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/huggingface/datasets/1.7.0/datasets/glue/glue.py">https://raw.githubusercontent.com/huggingface/datasets/1.7.0/datasets/glue/glue.py</a> without problemâ€¦</td>
<td>Hello,\r\nI am trying to run run_glue.py and it gives me this errorâ€¦</td>
</tr>
</tbody>
</table>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯„è®ºæˆåŠŸè¢«æ‰©å……ï¼Œ <strong>comments</strong> æ˜¯åŒ…å«ä¸ªäººè¯„è®ºçš„åˆ—ï¼ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº† Pandasè¦å®Œæˆçš„éƒ¨åˆ†åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ‡æ¢å› <strong>Dataset</strong> é€šè¿‡åŠ è½½ <strong>DataFrame</strong> åœ¨å†…å­˜ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datasets <span class="keyword">import</span> Dataset</span><br><span class="line"></span><br><span class="line">comments_dataset = Dataset.from_pandas(comments_df)</span><br><span class="line">comments_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;body&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">2842</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬è·å–åˆ°äº†å‡ åƒæ¡çš„è¯„è®ºï¼</p>
<p><strong>âœï¸ Try it out! çœ‹çœ‹èƒ½ä¸èƒ½ä¸ç”¨pandaså°±å¯ä»¥å®Œæˆåˆ—çš„æ‰©å……ï¼› è¿™æœ‰ç‚¹æ£˜æ‰‹ï¼› ä½ å¯èƒ½ä¼šå‘ç° ğŸ¤— Datasets æ–‡æ¡£çš„ <a target="_blank" rel="noopener" href="https://huggingface.co/docs/datasets/about_map_batch#batch-mapping">â€œBatch mappingâ€</a> å¯¹è¿™ä¸ªä»»åŠ¡å¾ˆæœ‰ç”¨ã€‚</strong></p>
<p><font size="5">åˆ›å»ºä¸€ä¸ªæ–°çš„<strong>comments_length</strong>åˆ—æ¥å­˜æ”¾æ¯æ¡è¯„è®ºçš„å­—æ•°ã€‚</font></p>
<p>ç°åœ¨æˆ‘ä»¬æ¯è¡Œæœ‰ä¸€ä¸ªè¯„è®ºï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>comments_length</strong> åˆ—æ¥å­˜æ”¾æ¯æ¡è¯„è®ºçš„å­—æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">comments_dataset = comments_dataset.<span class="built_in">map</span>(</span><br><span class="line">    <span class="keyword">lambda</span> x: &#123;<span class="string">&quot;comment_length&quot;</span>: <span class="built_in">len</span>(x[<span class="string">&quot;comments&quot;</span>].split())&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><font size="5">è¿‡æ»¤æ‰ç®€çŸ­çš„è¯„è®º</font></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–°åˆ—æ¥è¿‡æ»¤æ‰ç®€çŸ­çš„è¯„è®ºï¼Œå…¶ä¸­é€šå¸¸åŒ…æ‹¬â€œcc @lewtunâ€æˆ–â€œè°¢è°¢ï¼â€ä¹‹ç±»ä¸æˆ‘ä»¬çš„æœç´¢å¼•æ“æ— å…³çš„å†…å®¹ã€‚è™½ç„¶æ— æ³•ä¸ºè¿‡æ»¤å™¨é€‰æ‹©çš„ç²¾ç¡®æ•°å­—ï¼Œä½†å¤§çº¦å¤§äº15 ä¸ªå•è¯ä¼¼ä¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">comments_dataset = comments_dataset.<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;comment_length&quot;</span>] &gt; <span class="number">15</span>)</span><br><span class="line">comments_dataset</span><br><span class="line">Dataset(&#123;</span><br><span class="line">    features: [<span class="string">&#x27;html_url&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;comment_length&#x27;</span>],</span><br><span class="line">    num_rows: <span class="number">2098</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><font size="5">å°†é—®é¢˜æ ‡é¢˜ã€æè¿°å’Œè¯„è®ºè¿æ¥åˆ°ä¸€ä¸ªæ–°çš„ text åˆ—</font></p>
<p>ç¨å¾®æ¸…ç†äº†æˆ‘ä»¬çš„æ•°æ®é›†åï¼Œè®©æˆ‘ä»¬å°†é—®é¢˜æ ‡é¢˜ã€æè¿°å’Œè¯„è®ºè¿æ¥åˆ°ä¸€ä¸ªæ–°çš„ <strong>text</strong> åˆ—ã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ **Dataset.map()**æ¥åšåˆ°è¿™äº› ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">concatenate_text</span>(<span class="params">examples</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;text&quot;</span>: examples[<span class="string">&quot;title&quot;</span>]</span><br><span class="line">        + <span class="string">&quot; \n &quot;</span></span><br><span class="line">        + examples[<span class="string">&quot;body&quot;</span>]</span><br><span class="line">        + <span class="string">&quot; \n &quot;</span></span><br><span class="line">        + examples[<span class="string">&quot;comments&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">comments_dataset = comments_dataset.<span class="built_in">map</span>(concatenate_text)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç»ˆäºå‡†å¤‡å¥½åˆ›å»ºä¸€äº›åµŒå…¥äº†ï¼è®©æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<h3 id="3åˆ›å»ºæ–‡æœ¬åµŒå…¥"><a class="markdownIt-Anchor" href="#3åˆ›å»ºæ–‡æœ¬åµŒå…¥"></a> 3.åˆ›å»ºæ–‡æœ¬åµŒå…¥</h3>
<p>æˆ‘ä»¬åœ¨<a target="_blank" rel="noopener" href="https://huggingface.co/course/chapter2">ç¬¬äºŒç« </a>å­¦è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <strong>AutoModel</strong> ç±»æ¥å®Œæˆè¯åµŒå…¥ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ£€æŸ¥ç‚¹æ¥åŠ è½½æ¨¡å‹ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªåä¸º <strong>sentence-transformers</strong> ä¸“é—¨ç”¨äºåˆ›å»ºè¯åµŒå…¥ã€‚å¦‚åº“ä¸­<a target="_blank" rel="noopener" href="https://www.sbert.net/examples/applications/semantic-search/README.html#symmetric-vs-asymmetric-semantic-search">æ–‡æ¡£</a>æ‰€è¿°çš„ï¼Œæˆ‘ä»¬è¿™æ¬¡è¦å®ç°çš„æ˜¯éå¯¹ç§°è¯­ä¹‰æœç´¢ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€çŸ­çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ¯”å¦‚é—®é¢˜è¯„è®ºç­‰æ›´é•¿çš„æ–‡æ¡£ä¸­æ‰¾åˆ°å…¶ç­”æ¡ˆã€‚é€šè¿‡æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://www.sbert.net/docs/pretrained_models.html#model-overview">æ¨¡å‹æ¦‚è¿°è¡¨</a>æˆ‘ä»¬å¯ä»¥å‘ç° <strong>multi-qa-mpnet-base-dot-v1</strong> æ£€æŸ¥ç‚¹åœ¨è¯­ä¹‰æœç´¢æ–¹é¢å…·æœ‰æœ€ä½³æ€§èƒ½ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬è¿˜å°†ä½¿ç”¨ç›¸åŒçš„æ£€æŸ¥ç‚¹åŠ è½½æ ‡è®°å™¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer, AutoModel</span><br><span class="line"></span><br><span class="line">model_ckpt = <span class="string">&quot;sentence-transformers/multi-qa-mpnet-base-dot-v1&quot;</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(model_ckpt)</span><br><span class="line">model = AutoModel.from_pretrained(model_ckpt)</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†åŠ å¿«åµŒå…¥è¿‡ç¨‹ï¼Œå°†æ¨¡å‹å’Œè¾“å…¥æ”¾åœ¨ GPU è®¾å¤‡ä¸Šï¼Œæ‰€ä»¥ç°åœ¨è®©æˆ‘ä»¬è¿™æ ·åšï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">device = torch.device(<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line">model.to(device)</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ï¼Œ<font color="red">æˆ‘ä»¬å¸Œæœ›å°† GitHub é—®é¢˜è¯­æ–™åº“ä¸­çš„æ¯ä¸ªæ¡ç›®è¡¨ç¤ºä¸ºå•ä¸ªå‘é‡ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼â€œæ± åŒ–â€æˆ–å¹³å‡åŒ–æˆ‘ä»¬çš„æ ‡è®°åµŒå…¥ã€‚ä¸€ç§æµè¡Œçš„æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬æ¨¡å‹çš„è¾“å‡ºä¸Šæ‰§è¡ŒCLS æ± åŒ–ï¼Œæˆ‘ä»¬åªè·å–[CLS]ä»¤ç‰Œçš„æœ€åä¸€ä¸ªéšè—çŠ¶æ€ã€‚</font>ä»¥ä¸‹å‡½æ•°ä¸ºæˆ‘ä»¬æä¾›äº†è¿™æ ·çš„æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">cls_pooling</span>(<span class="params">model_output</span>):</span><br><span class="line">    <span class="keyword">return</span> model_output.last_hidden_state[:, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ ‡è®°æ–‡æ¡£åˆ—è¡¨ï¼Œå°†tensoræ”¾åœ¨ GPU ä¸Šï¼Œç„¶åæä¾›ç»™æ¨¡å‹ï¼Œæœ€åå¯¹è¾“å‡ºä½¿ç”¨CLS æ± åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_embeddings</span>(<span class="params">text_list</span>):</span><br><span class="line">    encoded_input = tokenizer(</span><br><span class="line">        text_list, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>, return_tensors=<span class="string">&quot;pt&quot;</span></span><br><span class="line">    )</span><br><span class="line">    encoded_input = &#123;k: v.to(device) <span class="keyword">for</span> k, v <span class="keyword">in</span> encoded_input.items()&#125;</span><br><span class="line">    model_output = model(**encoded_input)</span><br><span class="line">    <span class="keyword">return</span> cls_pooling(model_output)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æˆ‘ä»¬çš„è¯­æ–™åº“ä¸­è¾“å…¥ç¬¬ä¸€ä¸ªæ–‡æœ¬æ¡ç›®å¹¶æ£€æŸ¥è¾“å‡ºç»´åº¦æ¥æµ‹è¯•è¯¥å‡½æ•°æ˜¯å¦æœ‰æ•ˆï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">embedding = get_embeddings(comments_dataset[<span class="string">&quot;text&quot;</span>][<span class="number">0</span>])</span><br><span class="line">embedding.shape</span><br><span class="line">torch.Size([<span class="number">1</span>, <span class="number">768</span>])</span><br></pre></td></tr></table></figure>
<p>å¤ªå¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å°†è¯­æ–™åº“ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®è½¬æ¢ä¸º 768 ç»´å‘é‡ï¼æˆ‘ä»¬å¯ä»¥ç”¨ <strong>Dataset.map()</strong> åº”ç”¨æˆ‘ä»¬çš„ <strong>get_embeddings()</strong> å‡½æ•°åˆ°æˆ‘ä»¬è¯­æ–™åº“ä¸­çš„æ¯ä¸€è¡Œï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>embeddings</strong> åˆ—å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">embeddings_dataset = comments_dataset.<span class="built_in">map</span>(</span><br><span class="line">    <span class="keyword">lambda</span> x: &#123;<span class="string">&quot;embeddings&quot;</span>: get_embeddings(x[<span class="string">&quot;text&quot;</span>]).detach().cpu().numpy()[<span class="number">0</span>]&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²ç»å°†åµŒå…¥è½¬æ¢ä¸º NumPy æ•°ç»„â€”â€”è¿™æ˜¯å› ä¸ºå½“æˆ‘ä»¬å°è¯•ä½¿ç”¨ FAISS ç´¢å¼•å®ƒä»¬æ—¶ï¼ŒğŸ¤— Datasetséœ€è¦è¿™ç§æ ¼å¼ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè¿™æ ·åšã€‚</p>
<h3 id="4ä½¿ç”¨-faiss-è¿›è¡Œé«˜æ•ˆçš„ç›¸ä¼¼æ€§æœç´¢"><a class="markdownIt-Anchor" href="#4ä½¿ç”¨-faiss-è¿›è¡Œé«˜æ•ˆçš„ç›¸ä¼¼æ€§æœç´¢"></a> 4.ä½¿ç”¨ FAISS è¿›è¡Œé«˜æ•ˆçš„ç›¸ä¼¼æ€§æœç´¢</h3>
<p><font size="5">æŒ‡å®šæˆ‘ä»¬è¦ç´¢å¼•çš„æ•°æ®é›†çš„å“ªä¸€åˆ—</font></p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªè¯åµŒå…¥æ•°æ®é›†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›æ–¹æ³•æ¥æœç´¢å®ƒä»¬ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨ ğŸ¤— Datasetsä¸­ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç§°ä¸º FAISSæŒ‡æ•°.<a target="_blank" rel="noopener" href="https://faiss.ai/">FAISS</a> (short for Facebook AI Similarity Search) ï¼ˆFacebook AI Similarity Search çš„ç¼©å†™ï¼‰æ˜¯ä¸€ä¸ªæä¾›é«˜æ•ˆç®—æ³•æ¥å¿«é€Ÿæœç´¢å’Œèšç±»åµŒå…¥å‘é‡çš„åº“ã€‚<font color="red">FAISS èƒŒåçš„åŸºæœ¬æ€æƒ³æ˜¯åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®ç»“æ„ï¼Œç§°ä¸ºæŒ‡æ•°ã€‚</font>è¿™å…è®¸äººä»¬æ‰¾åˆ°å“ªäº›åµŒå…¥è¯ä¸è¾“å…¥çš„è¯åµŒå…¥ç›¸ä¼¼ã€‚åœ¨ ğŸ¤— Datasetsä¸­åˆ›å»ºä¸€ä¸ª FAISS ç´¢å¼•å¾ˆç®€å•â€”â€”æˆ‘ä»¬ä½¿ç”¨ <strong>Dataset.add_faiss_index()</strong> å‡½æ•°å¹¶æŒ‡å®šæˆ‘ä»¬è¦ç´¢å¼•çš„æ•°æ®é›†çš„å“ªä¸€åˆ—ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">embeddings_dataset.add_faiss_index(column=<span class="string">&quot;embeddings&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><font size="5">é—®é¢˜embedding</font></p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**Dataset.get_nearest_examples()**å‡½æ•°è¿›è¡Œæœ€è¿‘é‚»å±…æŸ¥æ‰¾ã€‚è®©æˆ‘ä»¬é€šè¿‡é¦–å…ˆåµŒå…¥ä¸€ä¸ªé—®é¢˜æ¥æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">question = <span class="string">&quot;How can I load a dataset offline?&quot;</span></span><br><span class="line">question_embedding = get_embeddings([question]).cpu().detach().numpy()</span><br><span class="line">question_embedding.shape</span><br><span class="line">torch.Size([<span class="number">1</span>, <span class="number">768</span>])</span><br></pre></td></tr></table></figure>
<p><font size="5">æ‰¾åˆ°æœ€ç›¸ä¼¼çš„åµŒå…¥</font></p>
<p>å°±åƒæ–‡æ¡£ä¸€æ ·ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ª 768 ç»´å‘é‡è¡¨ç¤ºæŸ¥è¯¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä¸æ•´ä¸ªè¯­æ–™åº“è¿›è¡Œæ¯”è¾ƒä»¥æ‰¾åˆ°æœ€ç›¸ä¼¼çš„åµŒå…¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scores, samples = embeddings_dataset.get_nearest_examples(</span><br><span class="line">    <span class="string">&quot;embeddings&quot;</span>, question_embedding, k=<span class="number">5</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><strong>Dataset.get_nearest_examples()</strong> å‡½æ•°è¿”å›ä¸€ä¸ªåˆ†æ•°å…ƒç»„ï¼Œå¯¹æŸ¥è¯¢å’Œæ–‡æ¡£ä¹‹é—´çš„ç›¸ä¼¼åº¦è¿›è¡Œæ’åºï¼Œä»¥åŠä¸€ç»„æœ€ä½³åŒ¹é…çš„ç»“æœï¼ˆè¿™é‡Œæ˜¯ 5 ä¸ªï¼‰ã€‚</p>
<p><font size="5">æ”¶é›†åˆ°pandas.DataFrame</font></p>
<p>è®©æˆ‘ä»¬æŠŠè¿™äº›æ”¶é›†åˆ°ä¸€ä¸ª <strong>pandas.DataFrame</strong> ä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">samples_df = pd.DataFrame.from_dict(samples)</span><br><span class="line">samples_df[<span class="string">&quot;scores&quot;</span>] = scores</span><br><span class="line">samples_df.sort_values(<span class="string">&quot;scores&quot;</span>, ascending=<span class="literal">False</span>, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p><font size="5">æŸ¥çœ‹æŸ¥è¯¢ä¸è¯„è®ºçš„åŒ¹é…ç¨‹åº¦</font></p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥éå†å‰å‡ è¡Œæ¥æŸ¥çœ‹æˆ‘ä»¬çš„æŸ¥è¯¢ä¸è¯„è®ºçš„åŒ¹é…ç¨‹åº¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> _, row <span class="keyword">in</span> samples_df.iterrows():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;COMMENT: <span class="subst">&#123;row.comments&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;SCORE: <span class="subst">&#123;row.scores&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;TITLE: <span class="subst">&#123;row.title&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;URL: <span class="subst">&#123;row.html_url&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">COMMENT: Requiring online connection is a deal breaker in some cases unfortunately so it&#x27;d be great if offline mode is added similar to how `transformers` loads models offline fine.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@mandubian&#x27;s second bullet point suggests that there&#x27;s a workaround allowing you to use your offline (custom?) dataset with `datasets`. Could you please elaborate on how that should look like?</span></span><br><span class="line"><span class="string">SCORE: 25.505046844482422</span></span><br><span class="line"><span class="string">TITLE: Discussion using datasets in offline mode</span></span><br><span class="line"><span class="string">URL: https://github.com/huggingface/datasets/issues/824</span></span><br><span class="line"><span class="string">==================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">COMMENT: The local dataset builders (csv, text , json and pandas) are now part of the `datasets` package since #1726 :)</span></span><br><span class="line"><span class="string">You can now use them offline</span></span><br><span class="line"><span class="string">\`\`\`python</span></span><br><span class="line"><span class="string">datasets = load_dataset(&quot;text&quot;, data_files=data_files)</span></span><br><span class="line"><span class="string">\`\`\`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">We&#x27;ll do a new release soon</span></span><br><span class="line"><span class="string">SCORE: 24.555509567260742</span></span><br><span class="line"><span class="string">TITLE: Discussion using datasets in offline mode</span></span><br><span class="line"><span class="string">URL: https://github.com/huggingface/datasets/issues/824</span></span><br><span class="line"><span class="string">==================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">COMMENT: I opened a PR that allows to reload modules that have already been loaded once even if there&#x27;s no internet.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Let me know if you know other ways that can make the offline mode experience better. I&#x27;d be happy to add them :)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">I already note the &quot;freeze&quot; modules option, to prevent local modules updates. It would be a cool feature.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt; @mandubian&#x27;s second bullet point suggests that there&#x27;s a workaround allowing you to use your offline (custom?) dataset with `datasets`. Could you please elaborate on how that should look like?</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Indeed `load_dataset` allows to load remote dataset script (squad, glue, etc.) but also you own local ones.</span></span><br><span class="line"><span class="string">For example if you have a dataset script at `./my_dataset/my_dataset.py` then you can do</span></span><br><span class="line"><span class="string">\`\`\`python</span></span><br><span class="line"><span class="string">load_dataset(&quot;./my_dataset&quot;)</span></span><br><span class="line"><span class="string">\`\`\`</span></span><br><span class="line"><span class="string">and the dataset script will generate your dataset once and for all.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">----------</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">About I&#x27;m looking into having `csv`, `json`, `text`, `pandas` dataset builders already included in the `datasets` package, so that they are available offline by default, as opposed to the other datasets that require the script to be downloaded.</span></span><br><span class="line"><span class="string">cf #1724</span></span><br><span class="line"><span class="string">SCORE: 24.14896583557129</span></span><br><span class="line"><span class="string">TITLE: Discussion using datasets in offline mode</span></span><br><span class="line"><span class="string">URL: https://github.com/huggingface/datasets/issues/824</span></span><br><span class="line"><span class="string">==================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">COMMENT: &gt; here is my way to load a dataset offline, but it **requires** an online machine</span></span><br><span class="line"><span class="string">&gt;</span></span><br><span class="line"><span class="string">&gt; 1. (online machine)</span></span><br><span class="line"><span class="string">&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>import datasets</p>
<p>data = datasets.load_dataset(â€¦)</p>
<p>data.save_to_disk(/YOUR/DATASET/DIR)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. copy the dir from online to the offline machine</span><br><span class="line"></span><br><span class="line">3. (offline machine)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>import datasets</p>
<p>data = datasets.load_from_disk(/SAVED/DATA/DIR)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTH.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SCORE: 22.893993377685547</span><br><span class="line">TITLE: Discussion using datasets in offline mode</span><br><span class="line">URL: https://github.com/huggingface/datasets/issues/824</span><br><span class="line">==================================================</span><br><span class="line"></span><br><span class="line">COMMENT: here is my way to load a dataset offline, but it **requires** an online machine</span><br><span class="line">1. (online machine)</span><br><span class="line">\`\`\`</span><br><span class="line">import datasets</span><br><span class="line">data = datasets.load_dataset(...)</span><br><span class="line">data.save_to_disk(/YOUR/DATASET/DIR)</span><br><span class="line">\`\`\`</span><br><span class="line">2. copy the dir from online to the offline machine</span><br><span class="line">3. (offline machine)</span><br><span class="line">\`\`\`</span><br><span class="line">import datasets</span><br><span class="line">data = datasets.load_from_disk(/SAVED/DATA/DIR)</span><br><span class="line">\`\`\`</span><br><span class="line"></span><br><span class="line">HTH.</span><br><span class="line">SCORE: 22.406635284423828</span><br><span class="line">TITLE: Discussion using datasets in offline mode</span><br><span class="line">URL: https://github.com/huggingface/datasets/issues/824</span><br><span class="line">==================================================</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>æˆ‘ä»¬çš„ç¬¬äºŒä¸ªæœç´¢ç»“æœä¼¼ä¹ä¸æŸ¥è¯¢ç›¸ç¬¦ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://example.com">HUI</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/20/huggingface_course/NLP_Course(5)/">http://example.com/2024/09/20/huggingface_course/NLP_Course(5)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://example.com" target="_blank">HUI</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/2021060111433875004.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/20/huggingface_course/NLP_Course(6.1)/" title="NLPè¯¾ç¨‹ï¼ˆå…­-ä¸Šï¼‰- Tokenizeråº“"><img class="cover" src="/img/2021060111433875004.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">NLPè¯¾ç¨‹ï¼ˆå…­-ä¸Šï¼‰- Tokenizeråº“</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/20/huggingface_course/NLP_Course(3)/" title="NLPè¯¾ç¨‹ï¼ˆä¸‰ï¼‰- å¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹"><img class="cover" src="/img/2021060111433875004.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">NLPè¯¾ç¨‹ï¼ˆä¸‰ï¼‰- å¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div><div class="comment-switch"><span class="first-comment">Valine</span><span id="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/87788970_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">HUI</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">40</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/kalabiqlx" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:kalabiqlx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#nlp%E8%AF%BE%E7%A8%8B%E4%BA%94-datasets%E5%BA%93"><span class="toc-text"> NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E4%B8%8D%E5%9C%A8-hub"><span class="toc-text"> æ•°æ®é›†ä¸åœ¨ Hub</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 1.åŠ è½½æœ¬åœ°æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%8A%A0%E8%BD%BD%E8%BF%9C%E7%A8%8B%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 2.åŠ è½½è¿œç¨‹æ•°æ®é›†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%87%E7%89%87%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-text"> åˆ‡ç‰‡ï¼ˆæ•°æ®æ¸…æ´—ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E5%88%87%E7%89%87%E4%B8%8E%E5%88%87%E5%88%86%E6%95%B0%E6%8D%AE"><span class="toc-text"> 1.åˆ‡ç‰‡ä¸åˆ‡åˆ†æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%88%97"><span class="toc-text"> 2.åˆ›å»ºæ–°çš„æ•°æ®åˆ—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E5%8A%A0%E9%80%9Fmap%E6%96%B9%E6%B3%95"><span class="toc-text"> 3.åŠ é€Ÿmapæ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4datasets%E5%92%8Cdataframes%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2"><span class="toc-text"> 4.Datasetså’ŒDataFramesçš„ç›¸äº’è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E5%88%9B%E5%BB%BA%E9%AA%8C%E8%AF%81%E9%9B%86"><span class="toc-text"> 5.åˆ›å»ºéªŒè¯é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 6.ä¿å­˜æ•°æ®é›†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#datasets%E7%94%A8%E4%BA%8E%E5%A4%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text"> Datasetsç”¨äºå¤§æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1pile"><span class="toc-text"> 1.Pile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="toc-text"> 2.å†…å­˜æ˜ å°„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%B5%81%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 3.æµæ•°æ®é›†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> åˆ›å»ºè‡ªå·±çš„æ•°æ®é›†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 1.è·å–æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E6%B8%85%E6%B4%97%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 2.æ¸…æ´—æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%89%A9%E5%85%85%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 3.æ‰©å……æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E4%B8%8A%E4%BC%A0%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 4.ä¸Šä¼ æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86%E5%8D%A1%E7%89%87"><span class="toc-text"> 5.åˆ›å»ºæ•°æ®é›†å¡ç‰‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-faiss-%E8%BF%9B%E8%A1%8C%E8%AF%AD%E4%B9%89%E6%90%9C%E7%B4%A2"><span class="toc-text"> ä½¿ç”¨ FAISS è¿›è¡Œè¯­ä¹‰æœç´¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E4%BD%BF%E7%94%A8embedding%E8%BF%9B%E8%A1%8C%E8%AF%AD%E4%B9%89%E6%90%9C%E7%B4%A2"><span class="toc-text"> 1.ä½¿ç”¨embeddingè¿›è¡Œè¯­ä¹‰æœç´¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-text"> 2.åŠ è½½å’Œå‡†å¤‡æ•°æ®é›†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E5%88%9B%E5%BB%BA%E6%96%87%E6%9C%AC%E5%B5%8C%E5%85%A5"><span class="toc-text"> 3.åˆ›å»ºæ–‡æœ¬åµŒå…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E4%BD%BF%E7%94%A8-faiss-%E8%BF%9B%E8%A1%8C%E9%AB%98%E6%95%88%E7%9A%84%E7%9B%B8%E4%BC%BC%E6%80%A7%E6%90%9C%E7%B4%A2"><span class="toc-text"> 4.ä½¿ç”¨ FAISS è¿›è¡Œé«˜æ•ˆçš„ç›¸ä¼¼æ€§æœç´¢</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/15/paper/SAM_introduce/" title="è¯­ä¹‰åˆ†å‰²ä¸SAMç²¾è¯»"><img src="/img/204405684.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="è¯­ä¹‰åˆ†å‰²ä¸SAMç²¾è¯»"/></a><div class="content"><a class="title" href="/2024/10/15/paper/SAM_introduce/" title="è¯­ä¹‰åˆ†å‰²ä¸SAMç²¾è¯»">è¯­ä¹‰åˆ†å‰²ä¸SAMç²¾è¯»</a><time datetime="2024-10-15T03:51:38.000Z" title="å‘è¡¨äº 2024-10-15 11:51:38">2024-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/12/paper/U-Net/" title="U-Netç²¾è¯»"><img src="/img/pob5vjumok.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="U-Netç²¾è¯»"/></a><div class="content"><a class="title" href="/2024/10/12/paper/U-Net/" title="U-Netç²¾è¯»">U-Netç²¾è¯»</a><time datetime="2024-10-12T06:05:38.000Z" title="å‘è¡¨äº 2024-10-12 14:05:38">2024-10-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/10/exercitation/bagu_CV(1)/" title="å…«è‚¡æ–‡-è®¡ç®—æœºè§†è§‰(ä¸€)">å…«è‚¡æ–‡-è®¡ç®—æœºè§†è§‰(ä¸€)</a><time datetime="2024-10-10T12:55:33.000Z" title="å‘è¡¨äº 2024-10-10 20:55:33">2024-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/10/exercitation/bagu_DeepLearning(1)/" title="å…«è‚¡æ–‡-æ·±åº¦å­¦ä¹ (ä¸€)">å…«è‚¡æ–‡-æ·±åº¦å­¦ä¹ (ä¸€)</a><time datetime="2024-10-10T12:55:33.000Z" title="å‘è¡¨äº 2024-10-10 20:55:33">2024-10-10</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/10/exercitation/bagu_LLM(1)/" title="å…«è‚¡æ–‡-å¤§æ¨¡å‹(ä¸€)">å…«è‚¡æ–‡-å¤§æ¨¡å‹(ä¸€)</a><time datetime="2024-10-10T12:55:33.000Z" title="å‘è¡¨äº 2024-10-10 20:55:33">2024-10-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/2021060111433875004.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2024 By HUI</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="èŠå¤©"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><script>(() => {
  const disqus_config = function () {
    this.page.url = 'http://example.com/2024/09/20/huggingface_course/NLP_Course(5)/'
    this.page.identifier = '/2024/09/20/huggingface_course/NLP_Course(5)/'
    this.page.title = 'NLPè¯¾ç¨‹ï¼ˆäº”ï¼‰- Datasetsåº“'
  }

  const disqusReset = () => {
    window.DISQUS && window.DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  btf.addGlobalFn('themeChange', disqusReset, 'disqus')

  const loadDisqus = () =>{
    if (window.DISQUS) disqusReset()
    else {
      const script = document.createElement('script')
      script.src = 'https://.disqus.com/embed.js'
      script.setAttribute('data-timestamp', +new Date())
      document.head.appendChild(script)
    }
  }

  const getCount = async() => {
    try {
      const eleGroup = document.querySelector('#post-meta .disqus-comment-count')
      if (!eleGroup) return
      const cleanedLinks = eleGroup.href.replace(/#post-comment$/, '')

      const res = await fetch(`https://disqus.com/api/3.0/threads/set.json?forum=&api_key=&thread:link=${cleanedLinks}`,{
        method: 'GET'
      })
      const result = await res.json()

      const count = result.response.length ? result.response[0].posts : 0
      eleGroup.textContent = count
    } catch (err) {
      console.error(err)
    }
  }

  if ('Valine' === 'Disqus' || !false) {
    if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
    else {
      loadDisqus()
      GLOBAL_CONFIG_SITE.isPost && getCount()
    }
  } else {
    window.loadOtherComment = loadDisqus
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>